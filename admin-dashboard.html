<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Адміністративна панель - Система замовлення харчування</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            min-height: 100vh;
            background: #FFFFFF;
            color: #333;
            overflow-x: hidden;
            overflow-y: auto;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            padding: 20px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-section {
            display: flex;
            align-items: center;
        }

        .logo {
            width: 50px;
            height: 87px;
            background: url(logo1.2.webp) center/contain no-repeat;
            margin-right: 15px;
        }

        .header-title {
            color: #FFFFFF;
        }

        .hospital-name {
            font-weight: 600;
            font-size: 18px;
            line-height: 1.2;
        }

        .system-name {
            font-weight: 300;
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .admin-details {
            text-align: right;
            color: #FFFFFF;
        }

        .admin-level {
            font-weight: 700;
            font-size: 16px;
            color: #FF6B6B;
        }

        .admin-username {
            font-weight: 400;
            font-size: 14px;
            opacity: 0.8;
        }

        .logout-btn {
            background-color: #e74c3c;
            border: none;
            border-radius: 8px;
            color: #FFFFFF;
            font-family: 'Open Sans', sans-serif;
            font-weight: 600;
            font-size: 14px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background-color: #c0392b;
            transform: translateY(-1px);
        }

        .main-container {
            margin-top: 120px;
            padding: 30px 20px 60px 20px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            min-height: calc(100vh - 120px);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
        }

        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border: 3px solid #2c3e50;
        }

        .dashboard-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            display: none;
        }

        .card-title {
            font-weight: 700;
            font-size: 18px;
            color: #2c3e50;
            line-height: 1.2;
        }

        .card-description {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .card-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-btn {
            border: none;
            border-radius: 8px;
            padding: 12px 15px;
            font-family: 'Open Sans', sans-serif;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }

        .btn-primary {
            background: #2c3e50;
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.3);
            background: #34495e;
        }

        .btn-secondary {
            background: white;
            color: #2c3e50;
            border: 3px solid #2c3e50;
            font-weight: 600;
        }

        .btn-secondary:hover {
            background-color: #f5f7fa;
            transform: translateY(-1px);
        }

        .btn-warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-warning:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.4);
        }


        /* Додаткові стилі для статистики */
        .stat-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }

        .stat-new {
            background-color: #f39c12;
            color: white;
        }

        .stat-confirmed {
            background-color: #27ae60;
            color: white;
        }

        .stat-completed {
            background-color: #2c3e50;
            color: white;
        }

        /* Стилі для розширених повідомлень */
        .orders-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .orders-header h3 {
            color: #2c3e50;
            margin: 0;
        }

        .orders-stats {
            display: flex;
            gap: 10px;
        }

        .cannot-delete {
            background-color: #95a5a6;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Стилі для форми замовлення меню */
        .department-menu-order .order-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .department-menu-order .order-header h3 {
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .order-info {
            color: #7f8c8d;
            font-size: 14px;
            margin: 0;
        }

        .meal-plan-info {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
        }

        .plan-details h4 {
            color: #495057;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .plan-details p {
            color: #6c757d;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .plan-price {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }

        .price-label {
            font-weight: 600;
            color: #495057;
        }

        .price-value {
            font-weight: 700;
            color: #28a745;
            font-size: 16px;
        }

        /* Стилі для підтвердження замовлення */
        .order-confirmation {
            text-align: center;
        }

        .confirmation-header {
            margin-bottom: 25px;
        }

        .confirmation-header h3 {
            color: #28a745;
            margin-bottom: 10px;
        }

        .order-number {
            background: #d4edda;
            color: #155724;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
        }

        .order-summary {
            text-align: left;
            margin-bottom: 25px;
        }

        .order-summary h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .summary-grid {
            display: grid;
            gap: 8px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-item .label {
            font-weight: 600;
            color: #6c757d;
        }

        .summary-item .value {
            color: #2c3e50;
        }

        .next-steps {
            background: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: left;
        }

        .next-steps h4 {
            color: #004085;
            margin-bottom: 10px;
        }

        .next-steps ul {
            margin: 0;
            padding-left: 20px;
        }

        .next-steps li {
            color: #004085;
            margin: 5px 0;
            font-size: 14px;
        }

        /* Стилі для сьогоднішніх замовлень */
        .todays-orders-view .todays-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .todays-date {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
            font-size: 14px;
            margin-top: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }

        .stat-card.total { border-left-color: #2c3e50; }
        .stat-card.amount { border-left-color: #27ae60; }
        .stat-card.new { border-left-color: #f39c12; }
        .stat-card.confirmed { border-left-color: #3498db; }
        .stat-card.completed { border-left-color: #27ae60; }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            text-transform: uppercase;
        }

        .meal-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .meal-stat-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .meal-type {
            font-weight: 600;
            color: #495057;
        }

        .meal-count, .meal-amount {
            font-size: 12px;
            color: #6c757d;
        }

        .todays-filters {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .todays-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        /* Стилі для відділень */
        .departments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .department-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .department-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            border-color: #007bff;
        }

        .dept-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .dept-header h4 {
            color: #2c3e50;
            margin: 0;
            font-size: 16px;
        }

        .dept-code {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .dept-stats {
            display: grid;
            gap: 8px;
        }

        .dept-stat-item {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }

        .dept-stat-item.total-amount {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #eee;
            font-weight: 600;
        }

        .stat-value.new { color: #f39c12; }
        .stat-value.confirmed { color: #3498db; }
        .stat-value.completed { color: #27ae60; }

        .dept-info {
            margin-top: 10px;
            color: #6c757d;
        }

        .departments-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        /* Стилізація скролбару */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        /* Для Firefox */
        html {
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) rgba(255, 255, 255, 0.1);
        }

        /* Блокування прокрутки коли відкрите модальне вікно */
        body.modal-open {
            overflow: hidden;
            padding-right: 0;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active { background-color: #27ae60; }
        .status-pending { background-color: #f39c12; }
        .status-inactive { background-color: #e74c3c; }

        .function-list {
            list-style: none;
            padding: 0;
        }

        .function-list li {
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
            color: #34495e;
            font-size: 14px;
        }

        .function-list li:last-child {
            border-bottom: none;
        }

        .function-list li:before {
            content: "•";
            color: #27ae60;
            font-weight: bold;
            margin-right: 8px;
        }

        /* Стили для модальных окон */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .modal-overlay .modal-window {
            cursor: default;
        }

        .modal-window {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        .modal-window.small { width: 90%; max-width: 400px; }
        .modal-window.medium { width: 90%; max-width: 600px; }
        .modal-window.large { width: 95%; max-width: 900px; }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            background: #2c3e50;
            color: white;
            padding: 20px 25px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }

        .modal-content {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-family: 'Open Sans', sans-serif;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2c3e50;
        }

        .modal-actions {
            margin-top: 25px;
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-family: 'Open Sans', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 13px;
        }

        /* Стили для уведомлений */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            max-width: 400px;
            z-index: 3000;
            animation: notificationSlideIn 0.3s ease;
        }

        .notification.success .notification-content {
            background: #27ae60;
        }

        .notification.error .notification-content {
            background: #e74c3c;
        }

        .notification.info .notification-content {
            background: #3498db;
        }

        .notification-content {
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Стилі для списку адміністраторів */
        .admins-list {
            display: grid;
            gap: 20px;
        }

        .admin-item {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .admin-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: #2c3e50;
        }

        .admin-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #dee2e6;
        }

        .admin-item-header h4 {
            margin: 0;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 700;
        }

        .admin-badge {
            background: #2c3e50;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .admin-item-details {
            display: grid;
            gap: 8px;
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #6c757d;
            font-size: 14px;
        }

        .detail-value {
            color: #2c3e50;
            font-size: 14px;
        }

        .admin-item-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .admin-item-actions .action-btn {
            flex: 1;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .large-modal .modal-content {
            max-width: 800px;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            margin-left: 15px;
        }

        @keyframes notificationSlideIn {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Специфические стили для контента модальных окон */
        .menu-editor {
            max-width: 100%;
        }

        .day-selector {
            margin-bottom: 20px;
        }

        .day-selector select {
            width: 200px;
            padding: 8px;
        }

        .meal-editors {
            display: grid;
            gap: 20px;
        }

        .meal-editor {
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 20px;
        }

        .meal-editor h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .price-manager .price-list {
            display: grid;
            gap: 15px;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
        }

        .price-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .price-control input {
            width: 100px;
        }

        .admin-list, .department-list {
            display: grid;
            gap: 15px;
        }

        .admin-item, .department-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
        }

        .orders-view .orders-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .orders-filter select, .orders-filter input {
            padding: 8px 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
        }

        .order-item {
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .order-id {
            font-weight: 700;
            color: #2c3e50;
        }

        .order-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-new { background: #f39c12; color: white; }
        .status-confirmed { background: #27ae60; color: white; }
        .status-other { background: #95a5a6; color: white; }

        .order-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .inventory-view .low-stock-alert {
            background: #ffe6e6;
            border: 2px solid #e74c3c;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .inventory-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .inventory-item.low-stock {
            border-color: #e74c3c;
            background: #ffe6e6;
        }

        .item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item-quantity input {
            width: 80px;
        }

        .kitchen-orders-list, .change-logs .logs-list {
            display: grid;
            gap: 15px;
        }

        .kitchen-order-item, .log-item {
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 15px;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 12px;
            color: #95a5a6;
        }

        .log-action {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .confirm-dialog {
            text-align: center;
        }

        .confirm-message {
            font-size: 16px;
            margin-bottom: 25px;
            color: #2c3e50;
        }

        .confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-active { background-color: #27ae60; }
        .status-inactive { background-color: #e74c3c; }

        .no-orders, .no-logs {
            text-align: center;
            color: #95a5a6;
            font-style: italic;
            padding: 40px 20px;
        }

        .inventory-report ul {
            margin: 20px 0;
            padding-left: 20px;
        }

        .inventory-report li {
            margin: 10px 0;
            color: #e74c3c;
        }

        /* Стили для продвинутого управления админами */
        .admin-management {
            max-width: 100%;
        }

        .admin-management-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .admin-card {
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.2s ease;
        }

        .admin-card:hover {
            border-color: #2c3e50;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.1);
        }

        .admin-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .admin-info h4 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .admin-meta {
            color: #95a5a6;
            font-size: 14px;
        }

        .admin-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-text {
            font-weight: 600;
            font-size: 14px;
        }

        .admin-details {
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: #7f8c8d;
            font-weight: 600;
            font-size: 13px;
        }

        .detail-value {
            color: #2c3e50;
            font-size: 13px;
        }

        .admin-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .protected-admin {
            color: #27ae60;
            font-weight: 600;
            font-size: 13px;
            padding: 8px 15px;
            background: #d5f4e6;
            border-radius: 20px;
            display: inline-block;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        /* Дополнительные стили для форм */
        .form-group small {
            color: #95a5a6;
            font-size: 12px;
            margin-top: 5px;
            display: block;
        }

        .form-group input:disabled {
            background-color: #ecf0f1;
            color: #7f8c8d;
            cursor: not-allowed;
        }

        .form-group label input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        /* Статистика админов */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        /* Стили для управления палатами */
        .room-management {
            max-width: 100%;
        }

        .room-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .room-management-header {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .departments-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-family: 'Open Sans', sans-serif;
            font-weight: 600;
            color: #7f8c8d;
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
        }

        .tab-btn:hover {
            color: #2c3e50;
            background: rgba(44, 62, 80, 0.1);
        }

        .tab-btn.active {
            color: #2c3e50;
            border-bottom-color: #2c3e50;
        }

        .department-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .department-header h3 {
            color: #2c3e50;
            margin: 0;
        }

        .department-info {
            color: #7f8c8d;
            font-size: 14px;
        }

        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .room-card {
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.2s ease;
        }

        .room-card:hover {
            border-color: #2c3e50;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.1);
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .room-number {
            font-size: 20px;
            font-weight: 700;
            color: #2c3e50;
        }

        .room-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .room-details {
            margin-bottom: 15px;
        }

        .room-detail {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #f8f9fa;
        }

        .room-detail:last-child {
            border-bottom: none;
        }

        .room-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .no-rooms {
            text-align: center;
            color: #95a5a6;
            font-style: italic;
            padding: 40px 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .status-warning {
            background-color: #f39c12;
        }

        /* Статистика по палатам */
        .room-statistics {
            max-width: 100%;
        }

        .stats-overview {
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            background: #2c3e50;
            color: white;
            border-radius: 10px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 800;
            display: block;
            margin-bottom: 5px;
        }

        .stats-by-department, .stats-by-type {
            margin-bottom: 30px;
        }

        .stats-by-department h3, .stats-by-type h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .department-stats, .type-stats {
            display: grid;
            gap: 10px;
        }

        .dept-stat-item, .type-stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .dept-name, .type-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .dept-numbers {
            display: flex;
            gap: 15px;
            color: #7f8c8d;
            font-size: 14px;
        }

        .type-count {
            color: #7f8c8d;
            font-size: 14px;
        }

        /* Формы для палат */
        .current-location {
            background: #e8f4f8;
            border: 1px solid #3498db;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .current-location h4 {
            color: #2980b9;
            margin-bottom: 8px;
        }

        .current-location p {
            color: #34495e;
            margin: 0;
        }

        /* Стили для управления отделениями */
        .department-management {
            max-width: 100%;
        }

        .department-management-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .department-list {
            display: grid;
            gap: 15px;
        }

        .department-item {
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.2s ease;
        }

        .department-item:hover {
            border-color: #2c3e50;
            box-shadow: 0 4px 15px rgba(44, 62, 80, 0.1);
        }

        .department-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .department-info h4 {
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .department-meta {
            color: #95a5a6;
            font-size: 14px;
        }

        .department-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .department-details {
            margin-bottom: 15px;
        }

        .department-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .department-stats {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .department-stats h4 {
            color: #34495e;
            margin-bottom: 10px;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .stats-row:last-child {
            border-bottom: none;
        }

        .stats-label {
            color: #7f8c8d;
            font-size: 14px;
        }

        .stats-value {
            color: #2c3e50;
            font-weight: 600;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .main-container {
                margin-top: 200px;
                padding: 20px 15px 40px 15px;
                min-height: calc(100vh - 200px);
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            /* Мобільний скролбар */
            ::-webkit-scrollbar {
                width: 4px;
            }
        }

        @media (max-width: 480px) {
            .main-container {
                padding: 15px 10px 30px 10px;
            }

            .dashboard-card {
                padding: 20px;
            }

            .card-title {
                font-size: 16px;
            }

            .card-description {
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo"></div>
                <div class="header-title">
                    <div class="hospital-name">КНП "КИЇВСЬКА МІСЬКА КЛІНІЧНА ЛІКАРНЯ №18"</div>
                    <div class="system-name">Адміністративна панель харчування</div>
                </div>
            </div>
            <div class="admin-info">
                <div class="admin-details">
                    <div class="admin-level" id="adminLevel">Головний адміністратор</div>
                    <div class="admin-username" id="adminUsername">admin_user</div>
                </div>
                <button class="logout-btn" onclick="logout()">Вийти</button>
            </div>
        </div>
    </header>

    <div class="main-container">
        <div class="dashboard-grid" id="seniorDashboard" style="display: none;">
            <!-- Редагування меню -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Редагування меню</div>
                        <div class="card-description">Управління стравами та позиціями меню на тиждень</div>
                    </div>
                </div>
                <div class="card-actions">
                    <button class="action-btn btn-primary" onclick="editMenu()">Редагувати меню</button>
                    <button class="action-btn btn-secondary" onclick="viewMenu()">Переглянути меню</button>
                    <button class="action-btn btn-secondary" onclick="printMenu()">Друк меню</button>
                </div>
            </div>

            <!-- Управління адміністраторами -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Управління адміністраторами</div>
                        <div class="card-description">Реєстрація та редагування облікових записів адміністраторів</div>
                    </div>
                </div>
                <div class="card-actions">
                    <button class="action-btn btn-primary" onclick="registerNewAdmin()">Зареєструвати нового адміна</button>
                    <button class="action-btn btn-secondary" onclick="viewActiveAdmins()">Список активних адміністраторів</button>
                    <button class="action-btn btn-secondary" onclick="viewDeactivatedAdmins()">Деактивовані адміністратори</button>
                </div>
            </div>

            <!-- Перегляд замовлень -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Перегляд замовлень</div>
                        <div class="card-description">Перегляд та аналіз замовлень харчування по відділеннях</div>
                    </div>
                </div>
                <div class="card-actions">
                    <button class="action-btn btn-primary" onclick="viewAllOrders()">Усі замовлення</button>
                    <!-- <button class="action-btn btn-secondary" onclick="viewOrdersArchive()">Архів замовлень</button> -->
                    <button class="action-btn btn-secondary" onclick="viewOrdersLog()">Логи замовлень</button>
                    <button class="action-btn btn-secondary" onclick="printOrders()">Друк замовлень</button>
                </div>
            </div>
        </div>

        <div class="dashboard-grid" id="juniorDashboard" style="display: none;">
            <!-- Меню -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Меню</div>
                        <div class="card-description">Перегляд та друк меню <br>на тиждень</div>
                    </div>
                </div>
                <div class="card-actions">
                    <button class="action-btn btn-primary" onclick="viewMenu()">Переглянути меню</button>
                    <button class="action-btn btn-secondary" onclick="printMenu()">Друк меню</button>
                </div>
            </div>

            <!-- Формування замовлення -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div>
                        <div class="card-title">Формування замовлення</div>
                        <div class="card-description">Внесення даних про замовлення харчування по вашому відділенню</div>
                    </div>
                </div>
                <div class="card-actions">
                    <button class="action-btn btn-primary" onclick="openOrderForm()">Заповнити замовлення</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Контейнер для модальных окон -->
    <div id="modalContainer"></div>

    <script src="admin-database.js"></script>
    <script>
        // ============================================
        // Система управління модальними вікнами
        // ============================================

        // Функція для відкриття модального вікна
        function openModal(modalElement) {
            document.body.classList.add('modal-open');

            // Додаємо обробник ESC
            const escHandler = function(e) {
                if (e.key === 'Escape') {
                    closeModal(modalElement, escHandler);
                }
            };

            // Зберігаємо обробник в елементі для подальшого видалення
            modalElement._escHandler = escHandler;
            document.addEventListener('keydown', escHandler);
        }

        // Функція для закриття модального вікна
        function closeModal(modalElement, escHandler) {
            if (modalElement && modalElement.parentNode) {
                modalElement.remove();
            }

            // Видаляємо обробник ESC
            if (escHandler) {
                document.removeEventListener('keydown', escHandler);
            } else if (modalElement && modalElement._escHandler) {
                document.removeEventListener('keydown', modalElement._escHandler);
            }

            // Перевіряємо, чи залишились інші модальні вікна
            const remainingModals = document.querySelectorAll('.modal-overlay');
            if (remainingModals.length === 0) {
                document.body.classList.remove('modal-open');
            }
        }

        // Глобальна функція для закриття модального вікна по кліку на overlay
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                const modal = e.target;
                closeModal(modal);
            }
        });

        // Запобігаємо закриттю при кліку на modal-window
        document.addEventListener('click', function(e) {
            if (e.target.closest('.modal-window')) {
                e.stopPropagation();
            }
        });

        // ============================================
        // Система логування дій адміністраторів
        // ============================================

        function addLog(action, details = {}) {
            const adminUsername = sessionStorage.getItem('adminUsername');
            const adminLevel = sessionStorage.getItem('adminLevel');

            // Получаем полное имя администратора
            let adminFullName = adminUsername;
            const adminDB = window.AdminDB;
            const admins = adminDB.getAdmins();
            const currentAdmin = admins[adminUsername];

            if (currentAdmin && currentAdmin.name) {
                adminFullName = currentAdmin.name;
            } else {
                const newAdmins = JSON.parse(localStorage.getItem('admins') || '{}');
                if (newAdmins[adminUsername] && newAdmins[adminUsername].fullName) {
                    adminFullName = newAdmins[adminUsername].fullName;
                }
            }

            const log = {
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString('uk-UA'),
                time: new Date().toLocaleTimeString('uk-UA'),
                adminUsername: adminUsername,
                adminFullName: adminFullName,
                adminLevel: adminLevel,
                action: action,
                details: details
            };

            // Получаем текущие логи
            let logs = JSON.parse(localStorage.getItem('ordersLogs') || '[]');

            // Добавляем новый лог в начало массива
            logs.unshift(log);

            // Ограничиваем количество логов (последние 1000)
            if (logs.length > 1000) {
                logs = logs.slice(0, 1000);
            }

            // Сохраняем логи
            localStorage.setItem('ordersLogs', JSON.stringify(logs));

            console.log('Лог додано:', log);
        }

        // ============================================
        // Перевірка аутентифікації при завантаженні сторінки
        // ============================================
        window.addEventListener('load', function() {
            const adminLevel = sessionStorage.getItem('adminLevel');
            const adminUsername = sessionStorage.getItem('adminUsername');

            if (!adminLevel || !adminUsername) {
                window.location.href = 'admin-login.html';
                return;
            }

            // Получаем полное имя администратора
            let adminFullName = adminUsername;
            const adminDB = window.AdminDB;
            const admins = adminDB.getAdmins();
            const currentAdmin = admins[adminUsername];

            if (currentAdmin && currentAdmin.name) {
                adminFullName = currentAdmin.name;
            } else {
                // Проверяем в новом хранилище
                const newAdmins = JSON.parse(localStorage.getItem('admins') || '{}');
                if (newAdmins[adminUsername] && newAdmins[adminUsername].fullName) {
                    adminFullName = newAdmins[adminUsername].fullName;
                }
            }

            // Відобразити інформацію про адміністратора
            if (adminLevel === 'senior') {
                document.getElementById('adminLevel').textContent = 'Головний адміністратор (Дієт сестра)';
                document.getElementById('seniorDashboard').style.display = 'grid';
                document.getElementById('juniorDashboard').style.display = 'none';
                setupSeniorAdmin();
            } else {
                document.getElementById('adminLevel').textContent = 'Молодший адміністратор (Старша сестра/Буфетниця)';
                document.getElementById('seniorDashboard').style.display = 'none';
                document.getElementById('juniorDashboard').style.display = 'grid';
                setupJuniorAdmin();
            }

            document.getElementById('adminUsername').textContent = adminFullName;
        });

        function setupSeniorAdmin() {
            // Показати всі картки для головного адміністратора
            // Всі картки вже видимі за замовчуванням
        }

        function setupJuniorAdmin() {
            // Отримати інформацію про відділення побочного адміна
            const adminUsername = sessionStorage.getItem('adminUsername');

            // Спочатку шукаємо в новому сховищі
            const newAdmins = JSON.parse(localStorage.getItem('admins') || '{}');
            let currentAdmin = null;
            let adminFullName = adminUsername;
            let adminDepartment = null;

            if (newAdmins[adminUsername]) {
                currentAdmin = newAdmins[adminUsername];
                adminFullName = currentAdmin.fullName || adminUsername;
                adminDepartment = currentAdmin.department;
            } else {
                // Якщо не знайдено в новому сховищі, шукаємо в старій базі
                const adminDB = window.AdminDB;
                if (adminDB) {
                    const admins = adminDB.getAdmins();
                    const oldAdmin = admins[adminUsername];
                    if (oldAdmin) {
                        currentAdmin = oldAdmin;
                        adminFullName = oldAdmin.name || adminUsername;
                        adminDepartment = oldAdmin.department;
                    }
                }
            }

            // Обновляем отображение имени
            document.getElementById('adminUsername').textContent = adminFullName;

            // Встановити відділення для фільтрації
            if (adminDepartment) {
                sessionStorage.setItem('adminDepartment', adminDepartment);
                const deptName = getDepartmentName(adminDepartment);
                document.getElementById('adminLevel').innerHTML = `Молодший адміністратор<br><small style="font-size: 12px; opacity: 0.8;">${deptName}</small>`;
            }

            // Повністю приховати картки для головного адміністратора
            const restrictedCards = [
                'contentCard', 'registrationCard', 'structureCard', 
                'inventoryCard', 'kitchenOrdersCard', 'updateControlCard'
            ];
            
            restrictedCards.forEach(cardId => {
                const card = document.getElementById(cardId);
                if (card) {
                    card.style.display = 'none';
                }
            });

            // Показати специфічні картки для молодшого адміністратора
            const departmentMenuCard = document.getElementById('departmentMenuCard');
            if (departmentMenuCard) departmentMenuCard.style.display = 'block';

            const validationCard = document.getElementById('validationCard');
            if (validationCard) validationCard.style.display = 'block';

            // Змінити текст кнопок для молодшого адміністратора
            const deptOrdersBtn = document.getElementById('deptOrdersBtn');
            if (deptOrdersBtn) deptOrdersBtn.textContent = 'Замовлення мого відділення';

            const printAllBtn = document.getElementById('printAllBtn');
            if (printAllBtn) printAllBtn.style.display = 'none'; // Приховати друк всіх замовлень

            const printDeptBtn = document.getElementById('printDeptBtn');
            if (printDeptBtn) printDeptBtn.textContent = 'Зведене замовлення мого відділення';
            
            // Додати обмеження у функції перегляду замовлень
            addJuniorAdminRestrictions();
        }
        
        function addJuniorAdminRestrictions() {
            // Модифікувати функції для побочного адміна
            const originalShowOrdersView = window.AdminModals.showOrdersView;
            window.AdminModals.showOrdersView = function() {
                const adminLevel = sessionStorage.getItem('adminLevel');
                const adminDepartment = sessionStorage.getItem('adminDepartment');
                
                if (adminLevel === 'junior' && adminDepartment) {
                    // Фільтрувати замовлення тільки для свого відділення
                    this.showDepartmentOrdersView(adminDepartment);
                } else {
                    originalShowOrdersView.call(this);
                }
            };
        }

        function logout() {
            sessionStorage.clear();
            window.location.href = 'admin-login.html';
        }

        // Функції для головного адміністратора (дієт сестра)
        function editMenu() {
            window.AdminModals.showMenuEditor();
        }

        function managePrices() {
            window.AdminModals.showPriceManager();
        }

        function managePhotos() {
            // window.AdminModals.showPhotoManager();
            alert('Функція управління фото тимчасово недоступна');
        }

        function registerAdmin() {
            window.AdminModals.showAdminRegistration();
        }

        function manageAdmins() {
            alert('Управління адміністраторами\n\nПереглянути та редагувати облікові записи молодших адміністраторів');
        }

        function manageDepartments() {
            alert('Управління відділеннями\n\nНалаштування структури відділень лікарні');
        }

        function manageRooms() {
            window.AdminModals.showAdvancedRoomManagement();
        }

        function viewInventory() {
            window.AdminModals.showInventoryView();
        }

        function updateInventory() {
            alert('Оновлення залишків\n\nВнесення змін у кількість продуктів на складі');
        }

        function inventoryReports() {
            alert('Звіти по залишкам\n\nДеталізовані звіти про рух продуктів');
        }

        function generateKitchenOrder() {
            alert('Формування замовлення на кухню\n\nСтворення зведеного замовлення для кухні на основі всіх замовлень пацієнтів');
        }

        function viewKitchenOrders() {
            alert('Перегляд замовлень на кухню\n\nІсторія та статус замовлень, відправлених на кухню');
        }

        function viewOrderUpdates() {
            window.AdminModals.showOrderUpdateControl();
        }

        function approveUpdates() {
            window.AdminModals.showOrderApprovalManager();
        }

        // Функції для молодшого адміністратора
        function orderDepartmentMenu() {
            window.AdminModals.showDepartmentMenuOrder();
        }

        function validateOrders() {
            window.AdminModals.showOrderValidationManager();
        }

        function viewValidationRules() {
            window.AdminModals.showValidationRules();
        }

        // Загальні функції для обох рівнів
        // function viewAllOrders() {
        //     window.AdminModals.showOrdersView();
        // }

        function viewTodayOrders() {
            window.AdminModals.showTodaysOrders();
        }

        function viewDepartmentOrders() {
            const adminLevel = sessionStorage.getItem('adminLevel');
            if (adminLevel === 'junior') {
                const adminDepartment = sessionStorage.getItem('adminDepartment');
                if (adminDepartment) {
                    window.AdminModals.showDepartmentOrdersView(adminDepartment);
                } else {
                    alert('Замовлення мого відділення\n\nЗамовлення тільки вашого відділення');
                }
            } else {
                window.AdminModals.showOrdersByDepartment();
            }
        }

        function editOrders() {
            window.AdminModals.showAdvancedOrderManagement();
        }

        function cancelOrders() {
            window.AdminModals.showOrderCancellationManager();
        }

        function printDepartmentSummary() {
            window.AdminModals.showPrintDepartmentSummary();
        }

        function printByType() {
            window.AdminModals.showPrintByType();
        }

        // Добавим недостающие функции которые еще не были реализованы
        function manageAdmins() {
            window.AdminModals.showAdvancedAdminManagement();
        }

        function manageDepartments() {
            window.AdminModals.showAdvancedDepartmentManagement();
        }

        function updateInventory() {
            window.AdminModals.showInventoryUpdateManager();
        }

        function inventoryReports() {
            const lowStockItems = window.AdminDB.getLowStockItems();
            let content = '<div class="inventory-report">';
            
            if (lowStockItems.length > 0) {
                content += '<h4 style="color: #e74c3c;">Товари з низькими залишками:</h4><ul>';
                lowStockItems.forEach(item => {
                    content += `<li>${item.name}: ${item.quantity} ${item.unit} (мін: ${item.minQuantity})</li>`;
                });
                content += '</ul>';
            } else {
                content += '<p style="color: #27ae60;">Всі товари в достатній кількості</p>';
            }
            
            content += '</div>';
            window.AdminModals.showModal(content, 'Звіт по залишкам', 'medium');
        }

        function generateKitchenOrder() {
            const orders = window.AdminDB.getOrders({ status: 'confirmed' });
            
            if (orders.length === 0) {
                window.AdminModals.showNotification('Немає підтверджених замовлень для формування', 'info');
                return;
            }
            
            const orderIds = orders.map(o => o.id);
            const adminUser = sessionStorage.getItem('adminUsername');
            
            window.AdminModals.showConfirm(
                `Сформувати замовлення для кухні на основі ${orders.length} підтверджених замовлень?`,
                () => {
                    const kitchenOrder = window.AdminDB.createKitchenOrder(orderIds, adminUser);
                    window.AdminModals.showNotification(`Замовлення для кухні #${kitchenOrder.id} створено!`, 'success');
                }
            );
        }

        function viewKitchenOrders() {
            const kitchenOrders = window.AdminDB.getKitchenOrders();
            let content = '<div class="kitchen-orders-list">';
            
            if (kitchenOrders.length === 0) {
                content += '<p class="no-orders">Замовлень для кухні не знайдено</p>';
            } else {
                kitchenOrders.slice(-10).reverse().forEach(order => {
                    content += `
                        <div class="kitchen-order-item">
                            <h4>Замовлення #${order.id}</h4>
                            <p>Створено: ${new Date(order.created).toLocaleString('uk-UA')}</p>
                            <p>Включає ${order.totalOrders} замовлень</p>
                            <p>Статус: ${order.status}</p>
                            <p>Термін: ${new Date(order.dueDate).toLocaleDateString('uk-UA')}</p>
                        </div>
                    `;
                });
            }
            
            content += '</div>';
            window.AdminModals.showModal(content, 'Замовлення для кухні', 'large');
        }

        function viewOrderUpdates() {
            window.AdminModals.showChangeLogs();
        }

        function editMenu() {
            const rations = [
                { name: '1 Раціон (Гіпотрофія)', color: '#2c3e50' },
                { name: '2 Раціон (Нормотрофія)', color: '#34495e' },
                { name: '3 Раціон (Гіпертрофія)', color: '#f39c12' },
                { name: 'Цукровий діабет 2 типу', color: '#e74c3c' },
                { name: 'Після операції', color: '#3498db' },
                { name: 'Зонд', color: '#7f8c8d' },
                { name: 'Кишкові', color: '#1abc9c' },
                { name: 'Індивідуальні', color: '#95a5a6' }
            ];

            const militaryRations = [
                { name: '1 Раціон', color: '#27ae60' },
                { name: '2 Раціон', color: '#2ecc71' },
                { name: '3 Раціон', color: '#16a085' },
                { name: 'Цукровий діабет 2 типу', color: '#e67e22' }
            ];

            let content = '<div class="menu-editor" style="max-height: 70vh; overflow-y: auto;">';

            // Основні раціони
            content += '<h3 style="color: #2c3e50; margin-bottom: 20px; font-size: 20px; border-bottom: 2px solid #2c3e50; padding-bottom: 10px;">Основні раціони</h3>';
            content += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-bottom: 30px;">';

            rations.forEach((ration, index) => {
                content += `
                    <div style="border: 2px solid #2c3e50; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease; background: white;"
                         onclick="openRationModal('main', ${index}, '${ration.name}', '${ration.color}')"
                         onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'"
                         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        <div style="font-weight: 600; color: #2c3e50; text-align: center; font-size: 16px; padding: 20px 0;">${ration.name}</div>
                    </div>
                `;
            });
            content += '</div>';

            // Військові раціони
            content += '<h3 style="color: #2c3e50; margin: 20px 0 20px 0; font-size: 20px; border-bottom: 2px solid #27ae60; padding-bottom: 10px;">Військові раціони</h3>';
            content += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">';

            militaryRations.forEach((ration, index) => {
                content += `
                    <div style="border: 2px solid #2c3e50; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease; background: white;"
                         onclick="openRationModal('military', ${index}, '${ration.name}', '${ration.color}')"
                         onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'"
                         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        <div style="font-weight: 600; color: #2c3e50; text-align: center; font-size: 16px; padding: 20px 0;">${ration.name}</div>
                    </div>
                `;
            });
            content += '</div>';

            content += '</div>';

            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.innerHTML = `
                <div class="modal-window large">
                    <div class="modal-header">
                        <h2 class="modal-title">Редагування меню</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">&times;</button>
                    </div>
                    <div class="modal-content">
                        ${content}
                    </div>
                </div>
            `;

            document.body.appendChild(modalOverlay);
            openModal(modalOverlay);
        }

        function openRationModal(type, index, name, color) {
            const days = ['Понеділок', 'Вівторок', 'Середа', 'Четвер', "П'ятниця", 'Субота', 'Неділя'];
            const meals = ['Сніданок', 'Обід', 'Вечеря'];

            let modalContent = `
                <div style="text-align: center; margin-bottom: 25px;">
                    <h3 style="color: #2c3e50; margin: 0; font-size: 22px;">${name}</h3>
                </div>

                <div class="form-group">
                    <label style="font-size: 16px; color: #2c3e50; font-weight: 600;">Оберіть день тижня:</label>
                    <select id="daySelect" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px;">
                        ${days.map((day, i) => `<option value="${i}">${day}</option>`).join('')}
                    </select>
                </div>

                <div id="dayContent">
            `;

            // Создаем контент для каждого дня
            days.forEach((day, dayIndex) => {
                modalContent += `
                    <div id="day_${dayIndex}" style="display: ${dayIndex === 0 ? 'block' : 'none'};">
                        <h4 style="color: #2c3e50; margin: 20px 0 15px 0; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px;">${day}</h4>
                `;

                meals.forEach((meal, mealIndex) => {
                    modalContent += `
                        <div style="margin-bottom: 25px; background: #f8f9fa; padding: 15px; border-radius: 10px;">
                            <label style="font-size: 15px; color: #2c3e50; font-weight: 600; margin-bottom: 10px; display: block;">${meal}</label>
                            <div id="dishes_${dayIndex}_${mealIndex}"></div>
                            <button class="btn btn-sm" onclick="addDish(${dayIndex}, ${mealIndex})"
                                style="margin-top: 10px; padding: 8px 15px; background: white; border: 2px solid #2c3e50; color: #2c3e50; border-radius: 6px; cursor: pointer; font-size: 13px;">
                                + Додати страву
                            </button>
                        </div>
                    `;
                });

                modalContent += `</div>`;
            });

            modalContent += `
                </div>

                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 25px; border-top: 2px solid #ecf0f1; padding-top: 20px;">
                    <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()" style="background: #2c3e50; color: white; border: none;">Скасувати</button>
                    <button class="btn btn-primary" onclick="saveRationData('${type}', ${index}, '${name}'); this.closest('.modal-overlay').remove();" style="background: #2c3e50; color: white; border: none;">Зберегти раціон</button>
                </div>
            `;

            const rationModal = document.createElement('div');
            rationModal.className = 'modal-overlay';
            rationModal.innerHTML = `
                <div class="modal-window medium">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Редагування раціону</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content">
                        ${modalContent}
                    </div>
                </div>
            `;

            document.body.appendChild(rationModal);

            // Инициализация обработчика смены дня
            document.getElementById('daySelect').addEventListener('change', function() {
                const days = document.querySelectorAll('[id^="day_"]');
                days.forEach(day => day.style.display = 'none');
                document.getElementById(`day_${this.value}`).style.display = 'block';
            });

            // Загрузка сохраненных данных
            loadRationData(type, index);
        }

        function loadRationData(type, index) {
            const rationKey = `ration_${type}_${index}`;
            const savedData = localStorage.getItem(rationKey);

            if (savedData) {
                const rationData = JSON.parse(savedData);
                const days = ['Понеділок', 'Вівторок', 'Середа', 'Четвер', "П'ятниця", 'Субота', 'Неділя'];

                days.forEach((day, dayIndex) => {
                    if (rationData[day]) {
                        // Загрузка сніданку
                        if (rationData[day].breakfast) {
                            rationData[day].breakfast.forEach(dish => {
                                if (dish.name || dish.grams) {
                                    addDish(dayIndex, 0);
                                    const container = document.getElementById(`dishes_${dayIndex}_0`);
                                    const lastDish = container.lastElementChild;
                                    const inputs = lastDish.querySelectorAll('input');
                                    inputs[0].value = dish.name || '';
                                    inputs[1].value = dish.grams || '';
                                }
                            });
                        }

                        // Загрузка обіду
                        if (rationData[day].lunch) {
                            rationData[day].lunch.forEach(dish => {
                                if (dish.name || dish.grams) {
                                    addDish(dayIndex, 1);
                                    const container = document.getElementById(`dishes_${dayIndex}_1`);
                                    const lastDish = container.lastElementChild;
                                    const inputs = lastDish.querySelectorAll('input');
                                    inputs[0].value = dish.name || '';
                                    inputs[1].value = dish.grams || '';
                                }
                            });
                        }

                        // Загрузка вечері
                        if (rationData[day].dinner) {
                            rationData[day].dinner.forEach(dish => {
                                if (dish.name || dish.grams) {
                                    addDish(dayIndex, 2);
                                    const container = document.getElementById(`dishes_${dayIndex}_2`);
                                    const lastDish = container.lastElementChild;
                                    const inputs = lastDish.querySelectorAll('input');
                                    inputs[0].value = dish.name || '';
                                    inputs[1].value = dish.grams || '';
                                }
                            });
                        }
                    }
                });
            }
        }

        function addDish(dayIndex, mealIndex) {
            const container = document.getElementById(`dishes_${dayIndex}_${mealIndex}`);
            const dishCount = container.children.length;

            const dishElement = document.createElement('div');
            dishElement.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px; align-items: center;';
            dishElement.innerHTML = `
                <input type="text" placeholder="Назва страви"
                    style="flex: 2; padding: 10px; border: 2px solid #ecf0f1; border-radius: 6px; font-size: 14px;">
                <input type="number" placeholder="Грами"
                    style="flex: 1; padding: 10px; border: 2px solid #ecf0f1; border-radius: 6px; font-size: 14px;">
                <button onclick="this.parentElement.remove()"
                    style="padding: 8px 12px; background: #e74c3c; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                    ✕
                </button>
            `;

            container.appendChild(dishElement);
        }

        function saveRationData(type, index, name) {
            const days = ['Понеділок', 'Вівторок', 'Середа', 'Четвер', "П'ятниця", 'Субота', 'Неділя'];
            const rationData = {};

            // Собираем данные со всех дней
            days.forEach((day, dayIndex) => {
                rationData[day] = {
                    breakfast: [],
                    lunch: [],
                    dinner: []
                };

                // Сніданок
                const breakfastDishes = document.querySelectorAll(`#dishes_${dayIndex}_0 > div`);
                breakfastDishes.forEach(dish => {
                    const inputs = dish.querySelectorAll('input');
                    rationData[day].breakfast.push({
                        name: inputs[0].value,
                        grams: inputs[1].value
                    });
                });

                // Обід
                const lunchDishes = document.querySelectorAll(`#dishes_${dayIndex}_1 > div`);
                lunchDishes.forEach(dish => {
                    const inputs = dish.querySelectorAll('input');
                    rationData[day].lunch.push({
                        name: inputs[0].value,
                        grams: inputs[1].value
                    });
                });

                // Вечеря
                const dinnerDishes = document.querySelectorAll(`#dishes_${dayIndex}_2 > div`);
                dinnerDishes.forEach(dish => {
                    const inputs = dish.querySelectorAll('input');
                    rationData[day].dinner.push({
                        name: inputs[0].value,
                        grams: inputs[1].value
                    });
                });
            });

            // Сохранение данных в localStorage
            const rationKey = `ration_${type}_${index}`;
            localStorage.setItem(rationKey, JSON.stringify(rationData));

            console.log(`Saving ${type} ration ${index}:`, rationData);

            // Показываем уведомление
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.innerHTML = `
                <div class="notification-content">
                    <span>Раціон "${name}" успішно збережено!</span>
                    <button class="notification-close" onclick="this.closest('.notification').remove()">&times;</button>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        // Функция для экспорта всех рационов
        function exportAllRations() {
            const allRations = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('ration_')) {
                    allRations[key] = JSON.parse(localStorage.getItem(key));
                }
            }
            console.log('All rations:', allRations);
            return allRations;
        }

        // Функция для очистки всех рационов
        function clearAllRations() {
            const keys = [];
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('ration_')) {
                    keys.push(key);
                }
            }
            keys.forEach(key => localStorage.removeItem(key));
            console.log('All rations cleared');
        }

        function viewMenu() {
            // Определяем текущий день недели
            const today = new Date();
            const dayIndex = (today.getDay() + 6) % 7; // Конвертируем в индекс (0 = понедельник)
            const days = ['Понеділок', 'Вівторок', 'Середа', 'Четвер', "П'ятниця", 'Субота', 'Неділя'];

            const rations = [
                { name: '1 Раціон (Гіпотрофія)', color: '#2c3e50' },
                { name: '2 Раціон (Нормотрофія)', color: '#34495e' },
                { name: '3 Раціон (Гіпертрофія)', color: '#f39c12' },
                { name: 'Цукровий діабет 2 типу', color: '#e74c3c' },
                { name: 'Після операції', color: '#3498db' },
                { name: 'Зонд', color: '#7f8c8d' },
                { name: 'Кишкові', color: '#1abc9c' },
                { name: 'Індивідуальні', color: '#95a5a6' }
            ];

            const militaryRations = [
                { name: '1 Раціон', color: '#27ae60' },
                { name: '2 Раціон', color: '#2ecc71' },
                { name: '3 Раціон', color: '#16a085' },
                { name: 'Цукровий діабет 2 типу', color: '#e67e22' }
            ];

            let content = `
                <div style="margin-bottom: 20px;">
                    <label style="font-size: 16px; color: #2c3e50; font-weight: 600; margin-bottom: 10px; display: block;">Оберіть день тижня:</label>
                    <select id="viewDaySelect" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px;">
                        ${days.map((day, i) => `<option value="${i}" ${i === dayIndex ? 'selected' : ''}>${day}</option>`).join('')}
                    </select>
                </div>

                <h3 style="color: #2c3e50; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #2c3e50; padding-bottom: 10px;">Основні раціони</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-bottom: 30px;">
            `;

            rations.forEach((ration, index) => {
                content += `
                    <div style="border: 2px solid #2c3e50; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease; background: white;"
                         onclick="viewRationMenu('main', ${index}, '${ration.name}', '${ration.color}')"
                         onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'"
                         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        <div style="font-weight: 600; color: #2c3e50; text-align: center; font-size: 16px; padding: 20px 0;">${ration.name}</div>
                    </div>
                `;
            });

            content += `</div>
                <h3 style="color: #2c3e50; margin: 20px 0 15px 0; font-size: 18px; border-bottom: 2px solid #27ae60; padding-bottom: 10px;">Військові раціони</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
            `;

            militaryRations.forEach((ration, index) => {
                content += `
                    <div style="border: 2px solid #2c3e50; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease; background: white;"
                         onclick="viewRationMenu('military', ${index}, '${ration.name}', '${ration.color}')"
                         onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.3)'"
                         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        <div style="font-weight: 600; color: #2c3e50; text-align: center; font-size: 16px; padding: 20px 0;">${ration.name}</div>
                    </div>
                `;
            });

            content += `</div>`;

            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.id = 'viewMenuModal';
            modalOverlay.innerHTML = `
                <div class="modal-window large">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Перегляд меню</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content">
                        ${content}
                    </div>
                </div>
            `;

            document.body.appendChild(modalOverlay);
            openModal(modalOverlay);
        }

        function viewRationMenu(type, index, name, color) {
            const rationKey = `ration_${type}_${index}`;
            const savedData = localStorage.getItem(rationKey);
            const days = ['Понеділок', 'Вівторок', 'Середа', 'Четвер', "П'ятниця", 'Субота', 'Неділя'];
            const selectedDayIndex = document.getElementById('viewDaySelect').value;
            const selectedDay = days[selectedDayIndex];

            let content = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3 style="color: #2c3e50; margin: 0 0 5px 0; font-size: 20px;">${name}</h3>
                    <p style="color: #7f8c8d; margin: 0; font-size: 14px;">${selectedDay}</p>
                </div>
            `;

            if (savedData) {
                const rationData = JSON.parse(savedData);
                const dayData = rationData[selectedDay];

                if (dayData) {
                    const meals = [
                        { title: 'Сніданок', data: dayData.breakfast },
                        { title: 'Обід', data: dayData.lunch },
                        { title: 'Вечеря', data: dayData.dinner }
                    ];

                    meals.forEach(meal => {
                        content += `
                            <div style="margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 10px;">
                                <div style="font-weight: 600; color: #2c3e50; margin-bottom: 10px; font-size: 16px;">${meal.title}</div>
                        `;

                        if (meal.data && meal.data.length > 0) {
                            meal.data.forEach(dish => {
                                if (dish.name) {
                                    content += `
                                        <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #dee2e6;">
                                            <span style="color: #34495e;">${dish.name}</span>
                                            <span style="color: #7f8c8d; font-weight: 600;">${dish.grams ? dish.grams + ' г' : '-'}</span>
                                        </div>
                                    `;
                                }
                            });
                        } else {
                            content += `<div style="color: #95a5a6; font-style: italic; padding: 10px 0;">Не заповнено</div>`;
                        }

                        content += `</div>`;
                    });
                } else {
                    content += `<div style="text-align: center; color: #95a5a6; font-style: italic; padding: 40px 20px;">Меню на цей день не заповнено</div>`;
                }
            } else {
                content += `<div style="text-align: center; color: #95a5a6; font-style: italic; padding: 40px 20px;">Меню не заповнено</div>`;
            }

            const rationModal = document.createElement('div');
            rationModal.className = 'modal-overlay';
            rationModal.innerHTML = `
                <div class="modal-window medium">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Перегляд раціону</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content">
                        ${content}
                    </div>
                </div>
            `;

            document.body.appendChild(rationModal);
        }

        function printMenu() {
            const today = new Date();
            const dayIndex = (today.getDay() + 6) % 7;
            const days = ['Понеділок', 'Вівторок', 'Середа', 'Четвер', "П'ятниця", 'Субота', 'Неділя'];

            let content = `
                <div style="margin-bottom: 25px;">
                    <label style="font-size: 16px; color: #2c3e50; font-weight: 600; margin-bottom: 10px; display: block;">Оберіть день для друку меню:</label>
                    <select id="printDaySelect" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px;">
                        ${days.map((day, i) => `<option value="${i}" ${i === dayIndex ? 'selected' : ''}>${day}</option>`).join('')}
                    </select>
                </div>

                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 25px;">
                    <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">Скасувати</button>
                    <button class="btn btn-primary" onclick="generatePrintMenu()" style="background: #2c3e50; color: white; border: none;">Сформувати для друку</button>
                </div>
            `;

            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.id = 'printMenuModal';
            modalOverlay.innerHTML = `
                <div class="modal-window medium">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Друк меню</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content">
                        ${content}
                    </div>
                </div>
            `;

            document.body.appendChild(modalOverlay);
            openModal(modalOverlay);
        }

        function generatePrintMenu() {
            const days = ['Понеділок', 'Вівторок', 'Середа', 'Четвер', "П'ятниця", 'Субота', 'Неділя'];
            const selectedDayIndex = document.getElementById('printDaySelect').value;
            const selectedDay = days[selectedDayIndex];

            // Закрываем модальное окно выбора дня
            document.getElementById('printMenuModal').remove();

            const rations = [
                { name: '1 Раціон (Гіпотрофія)', color: '#2c3e50' },
                { name: '2 Раціон (Нормотрофія)', color: '#34495e' },
                { name: '3 Раціон (Гіпертрофія)', color: '#f39c12' },
                { name: 'Цукровий діабет 2 типу', color: '#e74c3c' },
                { name: 'Після операції', color: '#3498db' },
                { name: 'Зонд', color: '#7f8c8d' },
                { name: 'Кишкові', color: '#1abc9c' },
                { name: 'Індивідуальні', color: '#95a5a6' }
            ];

            const militaryRations = [
                { name: '1 Раціон', color: '#27ae60' },
                { name: '2 Раціон', color: '#2ecc71' },
                { name: '3 Раціон', color: '#16a085' },
                { name: 'Цукровий діабет 2 типу', color: '#e67e22' }
            ];

            // Создаем HTML для печати
            let printContent = '<!DOCTYPE html><html lang="uk"><head><meta charset="UTF-8">';
            printContent += '<title>Меню на ' + selectedDay + '</title>';
            printContent += '<style>';
            printContent += '@page { size: A4 landscape; margin: 10mm; }';
            printContent += 'body { font-family: Arial, sans-serif; padding: 10px; font-size: 9px; }';
            printContent += 'h1 { text-align: center; color: #2c3e50; font-size: 16px; margin: 5px 0; }';
            printContent += 'h2 { color: #2c3e50; font-size: 12px; margin: 10px 0 5px 0; border-bottom: 2px solid #2c3e50; padding-bottom: 3px; }';
            printContent += 'table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 8px; }';
            printContent += 'th { background: #2c3e50; color: white; padding: 5px; text-align: left; border: 1px solid #2c3e50; font-size: 9px; }';
            printContent += 'td { padding: 4px; border: 1px solid #ddd; vertical-align: top; }';
            printContent += 'td.ration-name { font-weight: bold; background: #f5f7fa; width: 15%; }';
            printContent += 'td.meal-content { width: 28%; }';
            printContent += '.dish-item { margin: 2px 0; line-height: 1.3; }';
            printContent += '.dish-name { display: inline; }';
            printContent += '.dish-grams { display: inline; font-weight: bold; color: #7f8c8d; margin-left: 5px; }';
            printContent += '.no-data { color: #95a5a6; font-style: italic; font-size: 8px; }';
            printContent += '@media print { body { padding: 5px; } }';
            printContent += '</style></head><body>';
            printContent += '<h1>Меню на ' + selectedDay + ' - ' + new Date().toLocaleDateString('uk-UA') + '</h1>';

            // Основні раціони
            printContent += '<h2>Основні раціони</h2>';
            printContent += '<table><thead><tr><th>Раціон</th><th>Сніданок</th><th>Обід</th><th>Вечеря</th></tr></thead><tbody>';

            rations.forEach((ration, index) => {
                const rationKey = 'ration_main_' + index;
                const savedData = localStorage.getItem(rationKey);

                printContent += '<tr><td class="ration-name">' + ration.name + '</td>';

                if (savedData) {
                    const rationData = JSON.parse(savedData);
                    const dayData = rationData[selectedDay];

                    if (dayData) {
                        // Сніданок
                        printContent += '<td class="meal-content">';
                        if (dayData.breakfast && dayData.breakfast.length > 0) {
                            dayData.breakfast.forEach(dish => {
                                if (dish.name) {
                                    printContent += '<div class="dish-item"><span class="dish-name">' + dish.name + '</span>';
                                    if (dish.grams) printContent += '<span class="dish-grams">' + dish.grams + ' г</span>';
                                    printContent += '</div>';
                                }
                            });
                        } else {
                            printContent += '<span class="no-data">-</span>';
                        }
                        printContent += '</td>';

                        // Обід
                        printContent += '<td class="meal-content">';
                        if (dayData.lunch && dayData.lunch.length > 0) {
                            dayData.lunch.forEach(dish => {
                                if (dish.name) {
                                    printContent += '<div class="dish-item"><span class="dish-name">' + dish.name + '</span>';
                                    if (dish.grams) printContent += '<span class="dish-grams">' + dish.grams + ' г</span>';
                                    printContent += '</div>';
                                }
                            });
                        } else {
                            printContent += '<span class="no-data">-</span>';
                        }
                        printContent += '</td>';

                        // Вечеря
                        printContent += '<td class="meal-content">';
                        if (dayData.dinner && dayData.dinner.length > 0) {
                            dayData.dinner.forEach(dish => {
                                if (dish.name) {
                                    printContent += '<div class="dish-item"><span class="dish-name">' + dish.name + '</span>';
                                    if (dish.grams) printContent += '<span class="dish-grams">' + dish.grams + ' г</span>';
                                    printContent += '</div>';
                                }
                            });
                        } else {
                            printContent += '<span class="no-data">-</span>';
                        }
                        printContent += '</td>';
                    } else {
                        printContent += '<td colspan="3" class="no-data">Меню не заповнено</td>';
                    }
                } else {
                    printContent += '<td colspan="3" class="no-data">Меню не заповнено</td>';
                }

                printContent += '</tr>';
            });

            printContent += '</tbody></table>';

            // Військові раціони
            printContent += '<h2>Військові раціони</h2>';
            printContent += '<table><thead><tr><th>Раціон</th><th>Сніданок</th><th>Обід</th><th>Вечеря</th></tr></thead><tbody>';

            militaryRations.forEach((ration, index) => {
                const rationKey = 'ration_military_' + index;
                const savedData = localStorage.getItem(rationKey);

                printContent += '<tr><td class="ration-name">' + ration.name + '</td>';

                if (savedData) {
                    const rationData = JSON.parse(savedData);
                    const dayData = rationData[selectedDay];

                    if (dayData) {
                        // Сніданок
                        printContent += '<td class="meal-content">';
                        if (dayData.breakfast && dayData.breakfast.length > 0) {
                            dayData.breakfast.forEach(dish => {
                                if (dish.name) {
                                    printContent += '<div class="dish-item"><span class="dish-name">' + dish.name + '</span>';
                                    if (dish.grams) printContent += '<span class="dish-grams">' + dish.grams + ' г</span>';
                                    printContent += '</div>';
                                }
                            });
                        } else {
                            printContent += '<span class="no-data">-</span>';
                        }
                        printContent += '</td>';

                        // Обід
                        printContent += '<td class="meal-content">';
                        if (dayData.lunch && dayData.lunch.length > 0) {
                            dayData.lunch.forEach(dish => {
                                if (dish.name) {
                                    printContent += '<div class="dish-item"><span class="dish-name">' + dish.name + '</span>';
                                    if (dish.grams) printContent += '<span class="dish-grams">' + dish.grams + ' г</span>';
                                    printContent += '</div>';
                                }
                            });
                        } else {
                            printContent += '<span class="no-data">-</span>';
                        }
                        printContent += '</td>';

                        // Вечеря
                        printContent += '<td class="meal-content">';
                        if (dayData.dinner && dayData.dinner.length > 0) {
                            dayData.dinner.forEach(dish => {
                                if (dish.name) {
                                    printContent += '<div class="dish-item"><span class="dish-name">' + dish.name + '</span>';
                                    if (dish.grams) printContent += '<span class="dish-grams">' + dish.grams + ' г</span>';
                                    printContent += '</div>';
                                }
                            });
                        } else {
                            printContent += '<span class="no-data">-</span>';
                        }
                        printContent += '</td>';
                    } else {
                        printContent += '<td colspan="3" class="no-data">Меню не заповнено</td>';
                    }
                } else {
                    printContent += '<td colspan="3" class="no-data">Меню не заповнено</td>';
                }

                printContent += '</tr>';
            });

            printContent += '</tbody></table>';

            printContent += '<' + '/body><' + '/html>';

            // Открываем новое окно для печати
            const printWindow = window.open('', '', 'width=800,height=600');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();

            // Автоматически открываем диалог печати
            setTimeout(() => {
                printWindow.print();
            }, 250);
        }

        function registerNewAdmin() {
            let content = `
                <div class="form-group">
                    <label>Ім'я та Прізвище:</label>
                    <input type="text" id="adminFullName" placeholder="Введіть ім'я та прізвище">
                </div>

                <div class="form-group">
                    <label>Логін:</label>
                    <input type="text" id="adminLogin" placeholder="Введіть логін">
                </div>

                <div class="form-group">
                    <label>Пароль:</label>
                    <input type="password" id="adminPassword" placeholder="Введіть пароль">
                </div>

                <div class="form-group">
                    <label>Підтвердження паролю:</label>
                    <input type="password" id="adminPasswordConfirm" placeholder="Підтвердіть пароль">
                </div>

                <div class="form-group">
                    <label>Відділення:</label>
                    <select id="adminDepartment">
                        <option value="">-- Оберіть відділення --</option>
                        <option value="therapy">Терапевтичне</option>
                        <option value="cardiology">Кардіологічне</option>
                        <option value="neurology">Неврологічне</option>
                        <option value="stroke">Інсультне</option>
                        <option value="rehabilitation">Фіз. та реабілітац. мед</option>
                        <option value="gynecology">Гінекологічне</option>
                        <option value="surgery">Хірургічне</option>
                        <option value="proctology">Проктологічне</option>
                        <option value="oncology">Онкохіміотерапевтичне</option>
                        <option value="palliative">Паліативної допомоги</option>
                        <option value="reanimation">Реанімаційне</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Email (необов'язково):</label>
                    <input type="email" id="adminEmail" placeholder="Введіть email">
                </div>

                <div class="form-group">
                    <label>Телефон (необов'язково):</label>
                    <input type="tel" id="adminPhone" placeholder="Введіть телефон">
                </div>

                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 25px;">
                    <button class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">Скасувати</button>
                    <button class="btn btn-primary" onclick="saveNewAdmin()" style="background: #2c3e50; color: white; border: none;">Зареєструвати</button>
                </div>
            `;

            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.id = 'registerAdminModal';
            modalOverlay.innerHTML = `
                <div class="modal-window medium">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Реєстрація нового адміністратора</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content">
                        ${content}
                    </div>
                </div>
            `;

            document.body.appendChild(modalOverlay);
            openModal(modalOverlay);
        }

        function saveNewAdmin() {
            const fullName = document.getElementById('adminFullName').value;
            const login = document.getElementById('adminLogin').value;
            const password = document.getElementById('adminPassword').value;
            const passwordConfirm = document.getElementById('adminPasswordConfirm').value;
            const department = document.getElementById('adminDepartment').value;
            const email = document.getElementById('adminEmail').value;
            const phone = document.getElementById('adminPhone').value;

            // Валидация
            if (!fullName || !login || !password || !passwordConfirm || !department) {
                alert('Будь ласка, заповніть всі обов\'язкові поля');
                return;
            }

            if (password !== passwordConfirm) {
                alert('Паролі не співпадають');
                return;
            }

            // Создаем объект нового администратора
            const newAdmin = {
                fullName: fullName,
                login: login,
                password: password,
                level: 'junior',
                department: department,
                email: email,
                phone: phone,
                createdAt: new Date().toISOString(),
                active: true
            };

            // Сохраняем в localStorage
            let admins = JSON.parse(localStorage.getItem('admins') || '{}');

            // Проверяем, существует ли уже такой логин
            if (admins[login]) {
                alert('Адміністратор з таким логіном вже існує');
                return;
            }

            admins[login] = newAdmin;
            localStorage.setItem('admins', JSON.stringify(admins));

            // Додаємо лог
            addLog('Реєстрація нового адміністратора', {
                newAdminLogin: login,
                newAdminFullName: fullName,
                newAdminDepartment: getDepartmentName(department),
                newAdminEmail: email || 'Не вказано',
                newAdminPhone: phone || 'Не вказано'
            });

            // Закрываем модальное окно
            document.getElementById('registerAdminModal').remove();

            // Показываем уведомление
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.innerHTML = `
                <div class="notification-content">
                    <span>Адміністратор "${fullName}" успішно зареєстрований!</span>
                    <button class="notification-close" onclick="this.closest('.notification').remove()">&times;</button>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        function viewActiveAdmins() {
            // Получаем администраторов из обоих источников
            let admins = {};

            // Из нового хранилища (созданного через форму регистрации)
            const newAdmins = JSON.parse(localStorage.getItem('admins') || '{}');

            // Из старой базы данных (admin-database.js)
            const oldDB = JSON.parse(localStorage.getItem('hospital_admin_db') || '{}');
            if (oldDB.admins) {
                // Конвертируем формат старой БД в новый
                Object.entries(oldDB.admins).forEach(([username, admin]) => {
                    admins[username] = {
                        fullName: admin.name || username,
                        login: username,
                        password: admin.password,
                        level: admin.level,
                        department: admin.department || '',
                        email: admin.email || '',
                        phone: admin.phone || '',
                        createdAt: admin.created || new Date().toISOString(),
                        active: admin.active !== false
                    };
                });
            }

            // Объединяем с новыми администраторами (они имеют приоритет)
            Object.assign(admins, newAdmins);

            // Фильтруем: только активные и только младшие администраторы
            const adminsList = Object.entries(admins).filter(([login, admin]) =>
                admin.active !== false && admin.level === 'junior'
            );

            let content = '';

            if (adminsList.length === 0) {
                content = '<p style="text-align: center; color: #7f8c8d; padding: 30px; font-size: 16px;">Немає активних адміністраторів</p>';
            } else {
                content = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">';
                adminsList.forEach(([login, admin]) => {
                    const createdDate = new Date(admin.createdAt).toLocaleDateString('uk-UA');
                    content += `
                        <div style="border: 2px solid #2c3e50; border-radius: 12px; padding: 20px; transition: all 0.3s ease; background: white;"
                             onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.15)'"
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 2px solid #ecf0f1;">
                                <h4 style="margin: 0; color: #2c3e50; font-size: 16px; font-weight: 700;">${admin.fullName}</h4>
                                <span style="background: #2c3e50; color: white; padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: 600;">
                                    ${admin.level === 'junior' ? 'Молодший' : 'Старший'}
                                </span>
                            </div>
                            <div style="display: grid; gap: 8px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Логін:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${login}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Відділення:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${getDepartmentName(admin.department)}</span>
                                </div>
                                ${admin.email ? `
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Email:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${admin.email}</span>
                                </div>
                                ` : ''}
                                ${admin.phone ? `
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Телефон:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${admin.phone}</span>
                                </div>
                                ` : ''}
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Дата реєстрації:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${createdDate}</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button onclick="editAdmin('${login}')" style="flex: 1; background: #2c3e50; color: white; border: none; border-radius: 8px; padding: 10px; font-family: 'Open Sans', sans-serif; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.2s ease;"
                                        onmouseover="this.style.background='#34495e'"
                                        onmouseout="this.style.background='#2c3e50'">
                                    Редагувати
                                </button>
                                <button onclick="deactivateAdmin('${login}')" style="flex: 1; background: #e74c3c; color: white; border: none; border-radius: 8px; padding: 10px; font-family: 'Open Sans', sans-serif; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.2s ease;"
                                        onmouseover="this.style.background='#c0392b'"
                                        onmouseout="this.style.background='#e74c3c'">
                                    Деактивувати
                                </button>
                            </div>
                        </div>
                    `;
                });
                content += '</div>';
            }

            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.id = 'viewAdminsModal';
            modalOverlay.innerHTML = `
                <div class="modal-window large">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Активні адміністратори</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content">
                        <div style="margin-bottom: 20px;">
                            <label style="font-size: 16px; color: #2c3e50; font-weight: 600; margin-bottom: 10px; display: block;">Фільтр за відділенням:</label>
                            <select id="departmentFilter" onchange="filterAdminsByDepartment()" style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px; font-family: 'Open Sans', sans-serif;">
                                <option value="">Усі відділення</option>
                                <option value="therapy">Терапевтичне</option>
                                <option value="cardiology">Кардіологічне</option>
                                <option value="neurology">Неврологічне</option>
                                <option value="stroke">Інсультне</option>
                                <option value="rehabilitation">Фіз. та реабілітац. мед</option>
                                <option value="gynecology">Гінекологічне</option>
                                <option value="surgery">Хірургічне</option>
                                <option value="proctology">Проктологічне</option>
                                <option value="oncology">Онкохіміотерапевтичне</option>
                                <option value="palliative">Паліативної допомоги</option>
                                <option value="reanimation">Реанімаційне</option>
                            </select>
                        </div>
                        <div id="adminsListContainer">
                            ${content}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modalOverlay);
            openModal(modalOverlay);
        }

        function filterAdminsByDepartment() {
            const selectedDepartment = document.getElementById('departmentFilter').value;

            // Получаем администраторов из обоих источников
            let admins = {};

            // Из нового хранилища
            const newAdmins = JSON.parse(localStorage.getItem('admins') || '{}');

            // Из старой базы данных
            const oldDB = JSON.parse(localStorage.getItem('hospital_admin_db') || '{}');
            if (oldDB.admins) {
                Object.entries(oldDB.admins).forEach(([username, admin]) => {
                    admins[username] = {
                        fullName: admin.name || username,
                        login: username,
                        password: admin.password,
                        level: admin.level,
                        department: admin.department || '',
                        email: admin.email || '',
                        phone: admin.phone || '',
                        createdAt: admin.created || new Date().toISOString(),
                        active: admin.active !== false
                    };
                });
            }

            // Объединяем с новыми администраторами
            Object.assign(admins, newAdmins);

            // Фильтруем: только активные и только младшие администраторы
            let adminsList = Object.entries(admins).filter(([login, admin]) =>
                admin.active !== false && admin.level === 'junior'
            );

            // Фильтруем по отделению если выбрано
            if (selectedDepartment) {
                adminsList = adminsList.filter(([login, admin]) => {
                    // Проверяем по коду отделения
                    if (admin.department === selectedDepartment) return true;

                    // Проверяем по названию отделения (для старых данных)
                    const departmentName = getDepartmentName(selectedDepartment);
                    if (admin.department === departmentName) return true;

                    return false;
                });
            }

            let content = '';

            if (adminsList.length === 0) {
                content = '<p style="text-align: center; color: #7f8c8d; padding: 30px; font-size: 16px;">Немає адміністраторів за обраними критеріями</p>';
            } else {
                content = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">';
                adminsList.forEach(([login, admin]) => {
                    const createdDate = new Date(admin.createdAt).toLocaleDateString('uk-UA');
                    content += `
                        <div style="border: 2px solid #2c3e50; border-radius: 12px; padding: 20px; transition: all 0.3s ease; background: white;"
                             onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(0,0,0,0.15)'"
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 2px solid #ecf0f1;">
                                <h4 style="margin: 0; color: #2c3e50; font-size: 16px; font-weight: 700;">${admin.fullName}</h4>
                                <span style="background: #2c3e50; color: white; padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: 600;">
                                    ${admin.level === 'junior' ? 'Молодший' : 'Старший'}
                                </span>
                            </div>
                            <div style="display: grid; gap: 8px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Логін:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${login}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Відділення:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${getDepartmentName(admin.department)}</span>
                                </div>
                                ${admin.email ? `
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Email:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${admin.email}</span>
                                </div>
                                ` : ''}
                                ${admin.phone ? `
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Телефон:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${admin.phone}</span>
                                </div>
                                ` : ''}
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Дата реєстрації:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${createdDate}</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button onclick="editAdmin('${login}')" style="flex: 1; background: #2c3e50; color: white; border: none; border-radius: 8px; padding: 10px; font-family: 'Open Sans', sans-serif; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.2s ease;"
                                        onmouseover="this.style.background='#34495e'"
                                        onmouseout="this.style.background='#2c3e50'">
                                    Редагувати
                                </button>
                                <button onclick="deactivateAdmin('${login}')" style="flex: 1; background: #e74c3c; color: white; border: none; border-radius: 8px; padding: 10px; font-family: 'Open Sans', sans-serif; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.2s ease;"
                                        onmouseover="this.style.background='#c0392b'"
                                        onmouseout="this.style.background='#e74c3c'">
                                    Деактивувати
                                </button>
                            </div>
                        </div>
                    `;
                });
                content += '</div>';
            }

            // Обновляем только список администраторов
            document.getElementById('adminsListContainer').innerHTML = content;
        }

        function getDepartmentName(departmentCode) {
            const departments = {
                'therapy': 'Терапевтичне',
                'cardiology': 'Кардіологічне',
                'neurology': 'Неврологічне',
                'stroke': 'Інсультне',
                'rehabilitation': 'Фіз. та реабілітац. мед',
                'gynecology': 'Гінекологічне',
                'surgery': 'Хірургічне',
                'proctology': 'Проктологічне',
                'oncology': 'Онкохіміотерапевтичне',
                'palliative': 'Паліативної допомоги',
                'reanimation': 'Реанімаційне'
            };

            // Если это код, возвращаем название
            if (departments[departmentCode]) {
                return departments[departmentCode];
            }

            // Если это уже название (для старых данных), возвращаем как есть
            return departmentCode || 'Не вказано';
        }

        function getDepartmentCode(departmentName) {
            const departments = {
                'therapy': 'Терапевтичне',
                'cardiology': 'Кардіологічне',
                'neurology': 'Неврологічне',
                'stroke': 'Інсультне',
                'rehabilitation': 'Фіз. та реабілітац. мед',
                'gynecology': 'Гінекологічне',
                'surgery': 'Хірургічне',
                'proctology': 'Проктологічне',
                'oncology': 'Онкохіміотерапевтичне',
                'palliative': 'Паліативної допомоги',
                'reanimation': 'Реанімаційне'
            };

            // Альтернативные названия из старой базы данных
            const alternativeNames = {
                'Кардіологія': 'cardiology',
                'Неврологія': 'neurology',
                'Хірургія': 'surgery',
                'Терапія': 'therapy',
                'Харчування': 'senior'  // для главного админа
            };

            // Удаляем лишние пробелы
            const trimmedName = (departmentName || '').trim();

            // Проверяем альтернативные названия
            if (alternativeNames[trimmedName]) {
                return alternativeNames[trimmedName];
            }

            // Сначала ищем код по названию
            for (let code in departments) {
                if (departments[code] === trimmedName) {
                    return code;
                }
            }

            // Если это уже код, возвращаем его
            if (departments[trimmedName]) {
                return trimmedName;
            }

            // Если не нашли, возвращаем как есть
            return trimmedName;
        }

        function editAdmin(login) {
            // Получаем администраторов из обоих источников
            let admins = {};

            const newAdmins = JSON.parse(localStorage.getItem('admins') || '{}');
            const oldDB = JSON.parse(localStorage.getItem('hospital_admin_db') || '{}');

            if (oldDB.admins) {
                Object.entries(oldDB.admins).forEach(([username, admin]) => {
                    admins[username] = {
                        fullName: admin.name || username,
                        login: username,
                        password: admin.password,
                        level: admin.level,
                        department: admin.department || '',
                        email: admin.email || '',
                        phone: admin.phone || '',
                        createdAt: admin.created || new Date().toISOString(),
                        active: admin.active !== false
                    };
                });
            }

            Object.assign(admins, newAdmins);

            const admin = admins[login];

            if (!admin) {
                alert('Адміністратора не знайдено');
                return;
            }

            // Закрываем модальное окно списка
            const viewModal = document.getElementById('viewAdminsModal');
            if (viewModal) viewModal.remove();

            // Создаем модальное окно редактирования
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.id = 'editAdminModal';

            // Конвертируем department для правильного отображения
            const currentDept = getDepartmentCode(admin.department);

            modal.innerHTML = `
                <div class="modal-window" style="max-width: 700px; width: 90%;">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Редагування адміністратора</h2>
                        <button class="modal-close" onclick="document.getElementById('editAdminModal').remove(); viewActiveAdmins();" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content" style="padding: 25px;">
                        <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                            <!-- ПІБ -->
                            <div>
                                <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                                    ПІБ <span style="color: #e74c3c;">*</span>
                                </label>
                                <input type="text" id="editAdminFullName" value="${admin.fullName}"
                                       style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 6px; font-size: 14px; box-sizing: border-box;"
                                       required>
                            </div>

                            <!-- Логін -->
                            <div>
                                <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                                    Логін <span style="color: #e74c3c;">*</span>
                                </label>
                                <input type="text" id="editAdminLogin" value="${login}"
                                       style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 6px; font-size: 14px; background-color: #e9ecef; cursor: not-allowed; box-sizing: border-box;"
                                       disabled>
                                <small style="color: #7f8c8d; font-size: 12px;">Логін не можна змінити</small>
                            </div>

                            <!-- Відділення -->
                            <div>
                                <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                                    Відділення <span style="color: #e74c3c;">*</span>
                                </label>
                                <select id="editAdminDepartment"
                                        style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                                    <option value="">-- Оберіть відділення --</option>
                                    <option value="therapy" ${currentDept === 'therapy' ? 'selected' : ''}>Терапевтичне</option>
                                    <option value="cardiology" ${currentDept === 'cardiology' ? 'selected' : ''}>Кардіологічне</option>
                                    <option value="neurology" ${currentDept === 'neurology' ? 'selected' : ''}>Неврологічне</option>
                                    <option value="stroke" ${currentDept === 'stroke' ? 'selected' : ''}>Інсультне</option>
                                    <option value="rehabilitation" ${currentDept === 'rehabilitation' ? 'selected' : ''}>Фіз. та реабілітац. мед</option>
                                    <option value="gynecology" ${currentDept === 'gynecology' ? 'selected' : ''}>Гінекологічне</option>
                                    <option value="surgery" ${currentDept === 'surgery' ? 'selected' : ''}>Хірургічне</option>
                                    <option value="proctology" ${currentDept === 'proctology' ? 'selected' : ''}>Проктологічне</option>
                                    <option value="oncology" ${currentDept === 'oncology' ? 'selected' : ''}>Онкохіміотерапевтичне</option>
                                    <option value="palliative" ${currentDept === 'palliative' ? 'selected' : ''}>Паліативної допомоги</option>
                                    <option value="reanimation" ${currentDept === 'reanimation' ? 'selected' : ''}>Реанімаційне</option>
                                </select>
                            </div>

                            <!-- Email -->
                            <div>
                                <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                                    Email
                                </label>
                                <input type="email" id="editAdminEmail" value="${admin.email || ''}"
                                       placeholder="admin@hospital.ua"
                                       style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                            </div>

                            <!-- Телефон -->
                            <div>
                                <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                                    Телефон
                                </label>
                                <input type="tel" id="editAdminPhone" value="${admin.phone || ''}"
                                       placeholder="+380 XX XXX XX XX"
                                       style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                            </div>

                            <!-- Розділювач -->
                            <div style="border-top: 2px solid #ecf0f1; margin: 10px 0;"></div>
                            <div style="background: #fff8dc; padding: 12px; border-radius: 6px; border-left: 4px solid #f39c12;">
                                <strong style="color: #e67e22;">Зміна паролю</strong>
                                <p style="margin: 5px 0 0 0; font-size: 13px; color: #7f8c8d;">Залиште поля порожніми, якщо не хочете змінювати пароль</p>
                            </div>

                            <!-- Новий пароль -->
                            <div>
                                <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                                    Новий пароль
                                </label>
                                <input type="password" id="editAdminPassword" placeholder="••••••••"
                                       style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                            </div>

                            <!-- Підтвердження паролю -->
                            <div>
                                <label style="display: block; font-weight: 600; color: #2c3e50; margin-bottom: 8px;">
                                    Підтвердіть новий пароль
                                </label>
                                <input type="password" id="editAdminPasswordConfirm" placeholder="••••••••"
                                       style="width: 100%; padding: 12px; border: 2px solid #ecf0f1; border-radius: 6px; font-size: 14px; box-sizing: border-box;">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer" style="display: flex; gap: 15px; justify-content: flex-end; padding: 20px; background: #f8f9fa; border-top: 1px solid #dee2e6;">
                        <button class="action-btn btn-secondary"
                                onclick="document.getElementById('editAdminModal').remove(); viewActiveAdmins();"
                                style="min-width: 150px;">
                            Скасувати
                        </button>
                        <button class="action-btn btn-primary"
                                onclick="updateAdmin('${login}')"
                                style="min-width: 150px;">
                            Зберегти зміни
                        </button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            openModal(modal);
        }

        function updateAdmin(login) {
            const fullName = document.getElementById('editAdminFullName').value.trim();
            const level = 'junior'; // Всі створені адміністратори - молодші
            const department = document.getElementById('editAdminDepartment').value;
            const email = document.getElementById('editAdminEmail').value.trim();
            const phone = document.getElementById('editAdminPhone').value.trim();
            const password = document.getElementById('editAdminPassword').value;
            const passwordConfirm = document.getElementById('editAdminPasswordConfirm').value;

            // Валидация
            if (!fullName) {
                alert('Будь ласка, введіть ПІБ');
                return;
            }

            if (!department) {
                alert('Будь ласка, оберіть відділення');
                return;
            }

            if (password && password.length < 6) {
                alert('Пароль має містити мінімум 6 символів');
                return;
            }

            if (password && password !== passwordConfirm) {
                alert('Паролі не співпадають');
                return;
            }

            // Проверяем в новом хранилище
            const newAdmins = JSON.parse(localStorage.getItem('admins') || '{}');

            // Проверяем в старой БД
            const oldDB = JSON.parse(localStorage.getItem('hospital_admin_db') || '{}');

            let foundInNew = false;
            let foundInOld = false;

            // Обновляем в новом хранилище
            if (newAdmins[login]) {
                foundInNew = true;
                newAdmins[login].fullName = fullName;
                newAdmins[login].level = level;
                newAdmins[login].department = department;
                newAdmins[login].email = email;
                newAdmins[login].phone = phone;

                if (password) {
                    newAdmins[login].password = password;
                }

                localStorage.setItem('admins', JSON.stringify(newAdmins));
            }

            // Обновляем в старой БД
            if (oldDB.admins && oldDB.admins[login]) {
                foundInOld = true;
                oldDB.admins[login].name = fullName;
                oldDB.admins[login].level = level;
                oldDB.admins[login].department = getDepartmentName(department); // Сохраняем название для совместимости
                oldDB.admins[login].email = email;
                oldDB.admins[login].phone = phone;

                if (password) {
                    oldDB.admins[login].password = password;
                }

                localStorage.setItem('hospital_admin_db', JSON.stringify(oldDB));
            }

            if (!foundInNew && !foundInOld) {
                alert('Адміністратора не знайдено');
                return;
            }

            // Закрываем модальное окно редактирования
            document.getElementById('editAdminModal').remove();

            // Показываем уведомление
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.innerHTML = `
                <div class="notification-content">
                    <span>Дані адміністратора "${fullName}" успішно оновлено!</span>
                    <button class="notification-close" onclick="this.closest('.notification').remove()">&times;</button>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);

            // Открываем обратно список администраторов
            viewActiveAdmins();
        }

        function deactivateAdmin(login) {
            if (!confirm(`Ви впевнені, що хочете деактивувати адміністратора?`)) {
                return;
            }

            // Проверяем в новом хранилище
            const newAdmins = JSON.parse(localStorage.getItem('admins') || '{}');

            // Проверяем в старой БД
            const oldDB = JSON.parse(localStorage.getItem('hospital_admin_db') || '{}');

            let adminName = '';
            let foundInNew = false;
            let foundInOld = false;

            if (newAdmins[login]) {
                foundInNew = true;
                adminName = newAdmins[login].fullName;
                newAdmins[login].active = false;
                localStorage.setItem('admins', JSON.stringify(newAdmins));
            }

            if (oldDB.admins && oldDB.admins[login]) {
                foundInOld = true;
                adminName = oldDB.admins[login].name || login;
                oldDB.admins[login].active = false;
                localStorage.setItem('hospital_admin_db', JSON.stringify(oldDB));
            }

            if (!foundInNew && !foundInOld) {
                alert('Адміністратора не знайдено');
                return;
            }

            // Показываем уведомление
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.innerHTML = `
                <div class="notification-content">
                    <span>Адміністратор "${adminName}" деактивовано</span>
                    <button class="notification-close" onclick="this.closest('.notification').remove()">&times;</button>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);

            // Обновляем список без закрытия модального окна
            filterAdminsByDepartment();
        }

        function viewDeactivatedAdmins() {
            // Получаем администраторов из обоих источников
            let admins = {};

            const newAdmins = JSON.parse(localStorage.getItem('admins') || '{}');
            const oldDB = JSON.parse(localStorage.getItem('hospital_admin_db') || '{}');

            if (oldDB.admins) {
                Object.entries(oldDB.admins).forEach(([username, admin]) => {
                    admins[username] = {
                        fullName: admin.name || username,
                        login: username,
                        password: admin.password,
                        level: admin.level,
                        department: admin.department || '',
                        email: admin.email || '',
                        phone: admin.phone || '',
                        createdAt: admin.created || new Date().toISOString(),
                        active: admin.active !== false
                    };
                });
            }

            Object.assign(admins, newAdmins);

            // Фільтруем: только деактивированные и только младшие администраторы
            const adminsList = Object.entries(admins).filter(([login, admin]) =>
                admin.active === false && admin.level === 'junior'
            );

            let content = '';

            if (adminsList.length === 0) {
                content = '<p style="text-align: center; color: #7f8c8d; padding: 30px; font-size: 16px;">Немає деактивованих адміністраторів</p>';
            } else {
                content = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px;">';
                adminsList.forEach(([login, admin]) => {
                    const createdDate = new Date(admin.createdAt).toLocaleDateString('uk-UA');
                    content += `
                        <div style="border: 2px solid #e74c3c; border-radius: 12px; padding: 20px; transition: all 0.3s ease; background: #fff5f5;"
                             onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(231,76,60,0.2)'"
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 2px solid #ecf0f1;">
                                <h4 style="margin: 0; color: #2c3e50; font-size: 16px; font-weight: 700;">${admin.fullName}</h4>
                                <span style="background: #e74c3c; color: white; padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: 600;">
                                    Деактивовано
                                </span>
                            </div>
                            <div style="display: grid; gap: 8px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Логін:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${login}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Рівень:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${admin.level === 'junior' ? 'Молодший' : 'Старший'}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Відділення:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${getDepartmentName(admin.department)}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 6px 0;">
                                    <span style="font-weight: 600; color: #7f8c8d; font-size: 13px;">Дата реєстрації:</span>
                                    <span style="color: #2c3e50; font-size: 13px;">${createdDate}</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 15px;">
                                <button onclick="reactivateAdmin('${login}')" style="flex: 1; background: #27ae60; color: white; border: none; border-radius: 8px; padding: 10px; font-family: 'Open Sans', sans-serif; font-weight: 600; font-size: 13px; cursor: pointer; transition: all 0.2s ease;"
                                        onmouseover="this.style.background='#2ecc71'"
                                        onmouseout="this.style.background='#27ae60'">
                                    Активувати
                                </button>
                            </div>
                        </div>
                    `;
                });
                content += '</div>';
            }

            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.id = 'viewDeactivatedAdminsModal';
            modalOverlay.innerHTML = `
                <div class="modal-window large">
                    <div class="modal-header" style="background: #e74c3c;">
                        <h2 class="modal-title" style="color: white;">Деактивовані адміністратори</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content">
                        ${content}
                    </div>
                </div>
            `;

            document.body.appendChild(modalOverlay);
            openModal(modalOverlay);
        }

        function reactivateAdmin(login) {
            if (!confirm(`Ви впевнені, що хочете активувати адміністратора?`)) {
                return;
            }

            // Проверяем в новом хранилище
            const newAdmins = JSON.parse(localStorage.getItem('admins') || '{}');

            // Проверяем в старой БД
            const oldDB = JSON.parse(localStorage.getItem('hospital_admin_db') || '{}');

            let adminName = '';
            let foundInNew = false;
            let foundInOld = false;

            if (newAdmins[login]) {
                foundInNew = true;
                adminName = newAdmins[login].fullName;
                newAdmins[login].active = true;
                localStorage.setItem('admins', JSON.stringify(newAdmins));
            }

            if (oldDB.admins && oldDB.admins[login]) {
                foundInOld = true;
                adminName = oldDB.admins[login].name || login;
                oldDB.admins[login].active = true;
                localStorage.setItem('hospital_admin_db', JSON.stringify(oldDB));
            }

            if (!foundInNew && !foundInOld) {
                alert('Адміністратора не знайдено');
                return;
            }

            // Показываем уведомление
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.innerHTML = `
                <div class="notification-content">
                    <span>Адміністратор "${adminName}" активовано</span>
                    <button class="notification-close" onclick="this.closest('.notification').remove()">&times;</button>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);

            // Закрываем модальное окно и показываем список активных
            document.getElementById('viewDeactivatedAdminsModal').remove();
            viewActiveAdmins();
        }

        function viewAllOrders() {
            // Все отделения
            const departments = [
                { code: 'therapy', name: 'Терапевтичне' },
                { code: 'cardiology', name: 'Кардіологічне' },
                { code: 'neurology', name: 'Неврологічне' },
                { code: 'stroke', name: 'Інсультне' },
                { code: 'rehabilitation', name: 'Фіз. та реабілітац. мед' },
                { code: 'gynecology', name: 'Гінекологічне' },
                { code: 'surgery', name: 'Хірургічне' },
                { code: 'proctology', name: 'Проктологічне' },
                { code: 'oncology', name: 'Онкохіміотерапевтичне' },
                { code: 'palliative', name: 'Паліативної допомоги' },
                { code: 'reanimation', name: 'Реанімаційне' }
            ];

            // Все рационы в одной таблице (основные + военные)
            const allRations = [
                { name: '1 Раціон (Гіпотрофія)', type: 'basic' },
                { name: '2 Раціон (Нормотрофія)', type: 'basic' },
                { name: '3 Раціон (Гіпертрофія)', type: 'basic' },
                { name: 'ЦД 2 типу', type: 'basic' },
                { name: 'Після операції', type: 'basic' },
                { name: 'Зонд', type: 'basic' },
                { name: 'Кішкові', type: 'basic' },
                { name: 'Індивідуальні', type: 'basic' },
                { name: 'Військ. 1', type: 'military' },
                { name: 'Військ. 2', type: 'military' },
                { name: 'Військ. 3', type: 'military' },
                { name: 'Військ. ЦД', type: 'military' },
                { name: 'Не харчуються', type: 'none' },
                { name: 'Без харчування (військ.)', type: 'military_none' }
            ];

            // Генерация единой таблицы
            let tableHTML = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <thead>
                            <tr style="background: #2c3e50; color: white;">
                                <th style="padding: 8px 10px; text-align: left; border: 1px solid #000; font-weight: 600; min-width: 140px;">Найменування відділення</th>
                                <th style="padding: 8px 6px; text-align: center; border: 1px solid #000; font-weight: 600; min-width: 60px;">Кількість хворих</th>
                                ${allRations.map(ration => `<th style="padding: 8px 6px; text-align: center; border: 1px solid #000; font-weight: 600; min-width: 55px; writing-mode: vertical-rl; text-orientation: mixed; height: 120px;">${ration.name}</th>`).join('')}
                                <th style="padding: 8px 6px; text-align: center; border: 1px solid #000; font-weight: 600; background: #27ae60; min-width: 70px; writing-mode: vertical-rl; text-orientation: mixed; height: 120px;">Загальна кіл-ть на харч.</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            // Загружаем данные заказов
            const orders = JSON.parse(localStorage.getItem('departmentOrders') || '{}');
            console.log('Загруженные заказы:', orders);

            departments.forEach((dept, index) => {
                const bgColor = index % 2 === 0 ? '#ffffff' : '#f8f9fa';
                tableHTML += `
                    <tr style="background: ${bgColor};">
                        <td style="padding: 8px 10px; border: 1px solid #000; font-weight: 600; color: #2c3e50;">${dept.name}</td>
                `;

                // Получаем данные для этого отделения
                const deptData = orders[dept.code] || {};

                // Кількість хворих
                const totalPatients = deptData.total_patients || 0;
                tableHTML += `<td style="padding: 8px 6px; border: 1px solid #000; text-align: center; font-weight: 700;">${totalPatients}</td>`;

                // Все рационы
                const rationValues = [
                    deptData.ration_1 || 0,
                    deptData.ration_2 || 0,
                    deptData.ration_3 || 0,
                    deptData.diabetes || 0,
                    deptData.post_surgery || 0,
                    deptData.tube || 0,
                    deptData.intestinal || 0,
                    deptData.individual || 0,
                    deptData.military_1 || 0,
                    deptData.military_2 || 0,
                    deptData.military_3 || 0,
                    deptData.military_diabetes || 0,
                    deptData.not_eating || 0,
                    deptData.military_not_eating || 0
                ];

                rationValues.forEach(count => {
                    tableHTML += `
                        <td style="padding: 8px 6px; border: 1px solid #000; text-align: center;">${count}</td>
                    `;
                });

                // Загальна кількість на харчування
                const totalEating = deptData.total_eating || 0;
                tableHTML += `
                        <td style="padding: 8px 6px; border: 1px solid #000; text-align: center; font-weight: 700; background: #d5f4e6; color: #27ae60;">${totalEating}</td>
                    </tr>
                `;
            });

            // Строка ВСЬОГО
            tableHTML += `
                <tr style="background: #ecf0f1; font-weight: 700;">
                    <td style="padding: 8px 10px; border: 1px solid #000; text-align: center;">ВСЬОГО:</td>
            `;

            // Считаем итоги из всех отделений
            let grandTotalPatients = 0;
            let grandTotals = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]; // 14 рационов
            let grandTotalEating = 0;

            departments.forEach(dept => {
                const deptData = orders[dept.code] || {};
                grandTotalPatients += deptData.total_patients || 0;
                grandTotalEating += deptData.total_eating || 0;

                grandTotals[0] += deptData.ration_1 || 0;
                grandTotals[1] += deptData.ration_2 || 0;
                grandTotals[2] += deptData.ration_3 || 0;
                grandTotals[3] += deptData.diabetes || 0;
                grandTotals[4] += deptData.post_surgery || 0;
                grandTotals[5] += deptData.tube || 0;
                grandTotals[6] += deptData.intestinal || 0;
                grandTotals[7] += deptData.individual || 0;
                grandTotals[8] += deptData.military_1 || 0;
                grandTotals[9] += deptData.military_2 || 0;
                grandTotals[10] += deptData.military_3 || 0;
                grandTotals[11] += deptData.military_diabetes || 0;
                grandTotals[12] += deptData.not_eating || 0;
                grandTotals[13] += deptData.military_not_eating || 0;
            });

            tableHTML += `<td style="padding: 8px 6px; border: 1px solid #000; text-align: center;">${grandTotalPatients}</td>`;

            grandTotals.forEach(total => {
                tableHTML += `<td style="padding: 8px 6px; border: 1px solid #000; text-align: center;">${total}</td>`;
            });

            tableHTML += `
                    <td style="padding: 8px 6px; border: 1px solid #000; text-align: center; background: #27ae60; color: white;">${grandTotalEating}</td>
                </tr>
            `;

            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;

            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.id = 'viewOrdersModal';
            modalOverlay.innerHTML = `
                <div class="modal-window" style="max-width: 95%; width: 95%;">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Усі замовлення харчування</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content" style="padding: 20px;">
                        <div style="margin-bottom: 20px;">
                            <label style="font-size: 14px; color: #2c3e50; font-weight: 600; margin-bottom: 10px; display: block;">Фільтр за відділенням:</label>
                            <select id="orderDepartmentFilter" onchange="filterOrdersByDepartment()" style="width: 300px; padding: 10px; border: 2px solid #ecf0f1; border-radius: 8px; font-size: 14px; font-family: 'Open Sans', sans-serif;">
                                <option value="">Усі відділення</option>
                                ${departments.map(dept => `<option value="${dept.code}">${dept.name}</option>`).join('')}
                            </select>
                        </div>
                        <div id="ordersTableContainer">
                            ${tableHTML}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modalOverlay);
            openModal(modalOverlay);
        }

        function filterOrdersByDepartment() {
            const selectedDepartment = document.getElementById('orderDepartmentFilter').value;

            // Все отделения
            const departments = [
                { code: 'therapy', name: 'Терапевтичне' },
                { code: 'cardiology', name: 'Кардіологічне' },
                { code: 'neurology', name: 'Неврологічне' },
                { code: 'stroke', name: 'Інсультне' },
                { code: 'rehabilitation', name: 'Фіз. та реабілітац. мед' },
                { code: 'gynecology', name: 'Гінекологічне' },
                { code: 'surgery', name: 'Хірургічне' },
                { code: 'proctology', name: 'Проктологічне' },
                { code: 'oncology', name: 'Онкохіміотерапевтичне' },
                { code: 'palliative', name: 'Паліативної допомоги' },
                { code: 'reanimation', name: 'Реанімаційне' }
            ];

            // Все рационы в одной таблице
            const allRations = [
                { name: '1 Раціон (Гіпотрофія)', type: 'basic' },
                { name: '2 Раціон (Нормотрофія)', type: 'basic' },
                { name: '3 Раціон (Гіпертрофія)', type: 'basic' },
                { name: 'ЦД 2 типу', type: 'basic' },
                { name: 'Після операції', type: 'basic' },
                { name: 'Зонд', type: 'basic' },
                { name: 'Кішкові', type: 'basic' },
                { name: 'Індивідуальні', type: 'basic' },
                { name: 'Військ. 1', type: 'military' },
                { name: 'Військ. 2', type: 'military' },
                { name: 'Військ. 3', type: 'military' },
                { name: 'Військ. ЦД', type: 'military' },
                { name: 'Не харчуються', type: 'none' },
                { name: 'Без харчування (військ.)', type: 'military_none' }
            ];

            // Фильтруем отделения
            let filteredDepartments = departments;
            if (selectedDepartment) {
                filteredDepartments = departments.filter(dept => dept.code === selectedDepartment);
            }

            // Генерация таблицы
            let tableHTML = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <thead>
                            <tr style="background: #2c3e50; color: white;">
                                <th style="padding: 8px 10px; text-align: left; border: 1px solid #000; font-weight: 600; min-width: 140px;">Найменування відділення</th>
                                <th style="padding: 8px 6px; text-align: center; border: 1px solid #000; font-weight: 600; min-width: 60px;">Кількість хворих</th>
                                ${allRations.map(ration => `<th style="padding: 8px 6px; text-align: center; border: 1px solid #000; font-weight: 600; min-width: 55px; writing-mode: vertical-rl; text-orientation: mixed; height: 120px;">${ration.name}</th>`).join('')}
                                <th style="padding: 8px 6px; text-align: center; border: 1px solid #000; font-weight: 600; background: #27ae60; min-width: 70px; writing-mode: vertical-rl; text-orientation: mixed; height: 120px;">Загальна кіл-ть на харч.</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            // Загружаем данные заказов
            const orders = JSON.parse(localStorage.getItem('departmentOrders') || '{}');

            filteredDepartments.forEach((dept, index) => {
                const bgColor = index % 2 === 0 ? '#ffffff' : '#f8f9fa';
                tableHTML += `
                    <tr style="background: ${bgColor};">
                        <td style="padding: 8px 10px; border: 1px solid #000; font-weight: 600; color: #2c3e50;">${dept.name}</td>
                `;

                // Получаем данные для этого отделения
                const deptData = orders[dept.code] || {};

                const totalPatients = deptData.total_patients || 0;
                tableHTML += `<td style="padding: 8px 6px; border: 1px solid #000; text-align: center; font-weight: 700;">${totalPatients}</td>`;

                // Все рационы
                const rationValues = [
                    deptData.ration_1 || 0,
                    deptData.ration_2 || 0,
                    deptData.ration_3 || 0,
                    deptData.diabetes || 0,
                    deptData.post_surgery || 0,
                    deptData.tube || 0,
                    deptData.intestinal || 0,
                    deptData.individual || 0,
                    deptData.military_1 || 0,
                    deptData.military_2 || 0,
                    deptData.military_3 || 0,
                    deptData.military_diabetes || 0,
                    deptData.not_eating || 0,
                    deptData.military_not_eating || 0
                ];

                rationValues.forEach(count => {
                    tableHTML += `
                        <td style="padding: 8px 6px; border: 1px solid #000; text-align: center;">${count}</td>
                    `;
                });

                const totalEating = deptData.total_eating || 0;
                tableHTML += `
                        <td style="padding: 8px 6px; border: 1px solid #000; text-align: center; font-weight: 700; background: #d5f4e6; color: #27ae60;">${totalEating}</td>
                    </tr>
                `;
            });

            // Строка ВСЬОГО (только если показываем все отделения)
            if (!selectedDepartment) {
                tableHTML += `
                    <tr style="background: #ecf0f1; font-weight: 700;">
                        <td style="padding: 8px 10px; border: 1px solid #000; text-align: center;">ВСЬОГО:</td>
                `;

                // Подсчитываем реальные суммы по всем отделениям
                let grandTotalPatients = 0;
                let grandTotals = new Array(14).fill(0);
                let grandTotalEating = 0;

                filteredDepartments.forEach(dept => {
                    const deptData = orders[dept.code] || {};
                    grandTotalPatients += deptData.total_patients || 0;

                    const rationValues = [
                        deptData.ration_1 || 0,
                        deptData.ration_2 || 0,
                        deptData.ration_3 || 0,
                        deptData.diabetes || 0,
                        deptData.post_surgery || 0,
                        deptData.tube || 0,
                        deptData.intestinal || 0,
                        deptData.individual || 0,
                        deptData.military_1 || 0,
                        deptData.military_2 || 0,
                        deptData.military_3 || 0,
                        deptData.military_diabetes || 0,
                        deptData.not_eating || 0,
                        deptData.military_not_eating || 0
                    ];

                    rationValues.forEach((value, idx) => {
                        grandTotals[idx] += value;
                    });

                    grandTotalEating += deptData.total_eating || 0;
                });

                tableHTML += `<td style="padding: 8px 6px; border: 1px solid #000; text-align: center;">${grandTotalPatients}</td>`;

                grandTotals.forEach(total => {
                    tableHTML += `<td style="padding: 8px 6px; border: 1px solid #000; text-align: center;">${total}</td>`;
                });

                tableHTML += `
                        <td style="padding: 8px 6px; border: 1px solid #000; text-align: center; background: #27ae60; color: white;">${grandTotalEating}</td>
                    </tr>
                `;
            }

            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;

            // Обновляем таблицу
            document.getElementById('ordersTableContainer').innerHTML = tableHTML;
        }

        function printOrders() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.id = 'printOrdersModal';
            modal.innerHTML = `
                <div class="modal-window">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Друк замовлень</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content" style="padding: 30px; text-align: center;">
                        <p style="font-size: 16px; color: #2c3e50; margin-bottom: 30px;">Ви впевнені, що хочете роздрукувати всі замовлення?</p>
                        <div style="display: flex; gap: 15px; justify-content: center;">
                            <button class="action-btn btn-primary" onclick="generatePrintOrders()" style="min-width: 200px;">Друкувати усі замовлення</button>
                            <button class="action-btn btn-secondary" onclick="document.getElementById('printOrdersModal').remove()" style="min-width: 150px;">Скасувати</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            openModal(modal);
        }

        function openOrderForm() {
            const adminDepartment = sessionStorage.getItem('adminDepartment');

            if (!adminDepartment) {
                alert('Не вдалося визначити ваше відділення');
                return;
            }

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.id = 'orderFormModal';

            modal.innerHTML = `
                <div class="modal-window" style="max-width: 90%; width: 90%;">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Формування замовлення - ${getDepartmentName(adminDepartment)}</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content" style="padding: 20px;">
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                <thead>
                                    <tr style="background: #2c3e50; color: white;">
                                        <th style="padding: 10px; border: 1px solid #000;">Найменування</th>
                                        <th style="padding: 10px; border: 1px solid #000;">Значення</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000; font-weight: 600;">Кількість хворих</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_total_patients" min="0" value="0"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">1 Раціон (Гіпотрофія)</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_ration_1" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">2 Раціон (Нормотрофія)</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_ration_2" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">3 Раціон (Гіпертрофія)</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_ration_3" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">ЦД 2 типу</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_diabetes" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">Після операції</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_post_surgery" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">Зонд</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_tube" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">Кішкові</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_intestinal" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">Індивідуальні</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_individual" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">Військ. 1</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_military_1" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">Військ. 2</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_military_2" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">Військ. 3</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_military_3" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">Військ. ЦД</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_military_diabetes" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">Не харчуються</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_not_eating" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 10px; border: 1px solid #000;">Без харчування (військ.)</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_military_not_eating" min="0" value="0" onchange="calculateTotals()"
                                                   style="width: 100px; padding: 8px; border: 2px solid #ecf0f1; border-radius: 4px; text-align: center;">
                                        </td>
                                    </tr>
                                    <tr style="background: #d5f4e6;">
                                        <td style="padding: 10px; border: 1px solid #000; font-weight: 600;">Загальна кількість на харчування</td>
                                        <td style="padding: 10px; border: 1px solid #000;">
                                            <input type="number" id="order_total_eating" min="0" value="0"
                                                   style="width: 100px; padding: 8px; border: 2px solid #27ae60; border-radius: 4px; text-align: center; font-weight: 700; background: #d5f4e6;"
                                                   readonly disabled>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer" style="display: flex; gap: 15px; justify-content: flex-end;">
                        <button class="action-btn btn-secondary" onclick="document.getElementById('orderFormModal').remove()">Скасувати</button>
                        <button class="action-btn btn-primary" onclick="saveOrderForm()">Зберегти замовлення</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            openModal(modal);

            // Загрузить существующие данные, если есть
            loadOrderData(adminDepartment);
        }

        function calculateTotals() {
            // Получаем значения всех полей
            const ration1 = parseInt(document.getElementById('order_ration_1').value) || 0;
            const ration2 = parseInt(document.getElementById('order_ration_2').value) || 0;
            const ration3 = parseInt(document.getElementById('order_ration_3').value) || 0;
            const diabetes = parseInt(document.getElementById('order_diabetes').value) || 0;
            const postSurgery = parseInt(document.getElementById('order_post_surgery').value) || 0;
            const tube = parseInt(document.getElementById('order_tube').value) || 0;
            const intestinal = parseInt(document.getElementById('order_intestinal').value) || 0;
            const individual = parseInt(document.getElementById('order_individual').value) || 0;
            const military1 = parseInt(document.getElementById('order_military_1').value) || 0;
            const military2 = parseInt(document.getElementById('order_military_2').value) || 0;
            const military3 = parseInt(document.getElementById('order_military_3').value) || 0;
            const militaryDiabetes = parseInt(document.getElementById('order_military_diabetes').value) || 0;
            const notEating = parseInt(document.getElementById('order_not_eating').value) || 0;
            const militaryNotEating = parseInt(document.getElementById('order_military_not_eating').value) || 0;

            // Количество на харчування = все кроме "не харчуються" и "без харчування"
            const totalEating = ration1 + ration2 + ration3 + diabetes + postSurgery + tube + intestinal + individual +
                               military1 + military2 + military3 + militaryDiabetes;

            // Обновляем только поле "Загальна кількість на харчування"
            document.getElementById('order_total_eating').value = totalEating;
        }

        function loadOrderData(department) {
            // Конвертируем название отделения в код
            const departmentCode = getDepartmentCode(department);

            // Загрузить сохраненные данные из localStorage
            const orders = JSON.parse(localStorage.getItem('departmentOrders') || '{}');

            if (orders[departmentCode]) {
                const data = orders[departmentCode];
                document.getElementById('order_total_patients').value = data.total_patients || 0;
                document.getElementById('order_ration_1').value = data.ration_1 || 0;
                document.getElementById('order_ration_2').value = data.ration_2 || 0;
                document.getElementById('order_ration_3').value = data.ration_3 || 0;
                document.getElementById('order_diabetes').value = data.diabetes || 0;
                document.getElementById('order_post_surgery').value = data.post_surgery || 0;
                document.getElementById('order_tube').value = data.tube || 0;
                document.getElementById('order_intestinal').value = data.intestinal || 0;
                document.getElementById('order_individual').value = data.individual || 0;
                document.getElementById('order_military_1').value = data.military_1 || 0;
                document.getElementById('order_military_2').value = data.military_2 || 0;
                document.getElementById('order_military_3').value = data.military_3 || 0;
                document.getElementById('order_military_diabetes').value = data.military_diabetes || 0;
                document.getElementById('order_not_eating').value = data.not_eating || 0;
                document.getElementById('order_military_not_eating').value = data.military_not_eating || 0;

                calculateTotals();
            }
        }

        function saveOrderForm() {
            const adminDepartment = sessionStorage.getItem('adminDepartment');

            if (!adminDepartment) {
                alert('Помилка: не вдалося визначити відділення');
                return;
            }

            // Конвертируем название отделения в код
            const departmentCode = getDepartmentCode(adminDepartment);

            // Собираем данные
            const orderData = {
                ration_1: parseInt(document.getElementById('order_ration_1').value) || 0,
                ration_2: parseInt(document.getElementById('order_ration_2').value) || 0,
                ration_3: parseInt(document.getElementById('order_ration_3').value) || 0,
                diabetes: parseInt(document.getElementById('order_diabetes').value) || 0,
                post_surgery: parseInt(document.getElementById('order_post_surgery').value) || 0,
                tube: parseInt(document.getElementById('order_tube').value) || 0,
                intestinal: parseInt(document.getElementById('order_intestinal').value) || 0,
                individual: parseInt(document.getElementById('order_individual').value) || 0,
                military_1: parseInt(document.getElementById('order_military_1').value) || 0,
                military_2: parseInt(document.getElementById('order_military_2').value) || 0,
                military_3: parseInt(document.getElementById('order_military_3').value) || 0,
                military_diabetes: parseInt(document.getElementById('order_military_diabetes').value) || 0,
                not_eating: parseInt(document.getElementById('order_not_eating').value) || 0,
                military_not_eating: parseInt(document.getElementById('order_military_not_eating').value) || 0,
                total_patients: parseInt(document.getElementById('order_total_patients').value) || 0,
                total_eating: parseInt(document.getElementById('order_total_eating').value) || 0,
                updated_at: new Date().toISOString()
            };

            // Сохраняем в localStorage используя код отделения
            const orders = JSON.parse(localStorage.getItem('departmentOrders') || '{}');
            orders[departmentCode] = orderData;
            localStorage.setItem('departmentOrders', JSON.stringify(orders));

            // Также сохраняем в архив по датам
            const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
            const ordersArchive = JSON.parse(localStorage.getItem('ordersArchive') || '{}');

            if (!ordersArchive[today]) {
                ordersArchive[today] = {};
            }

            ordersArchive[today][departmentCode] = orderData;
            localStorage.setItem('ordersArchive', JSON.stringify(ordersArchive));

            console.log('Сохранено для отделения:', departmentCode, '(было:', adminDepartment, ')');
            console.log('Данные:', orderData);
            console.log('Все заказы после сохранения:', orders);

            // Додаємо лог
            addLog('Збереження замовлення', {
                department: getDepartmentName(departmentCode),
                departmentCode: departmentCode,
                totalPatients: orderData.total_patients,
                totalEating: orderData.total_eating,
                orderData: orderData
            });

            // Показываем уведомление
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.innerHTML = `
                <div class="notification-content">
                    <span>Замовлення успішно збережено!</span>
                    <button class="notification-close" onclick="this.closest('.notification').remove()">&times;</button>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);

            // Закрываем модальное окно
            document.getElementById('orderFormModal').remove();
        }

        function generatePrintOrders() {
            document.getElementById('printOrdersModal').remove();

            // Все отделения
            const departments = [
                { code: 'therapy', name: 'Терапевтичне' },
                { code: 'cardiology', name: 'Кардіологічне' },
                { code: 'neurology', name: 'Неврологічне' },
                { code: 'stroke', name: 'Інсультне' },
                { code: 'rehabilitation', name: 'Фіз. та реабілітац. мед' },
                { code: 'gynecology', name: 'Гінекологічне' },
                { code: 'surgery', name: 'Хірургічне' },
                { code: 'proctology', name: 'Проктологічне' },
                { code: 'oncology', name: 'Онкохіміотерапевтичне' },
                { code: 'palliative', name: 'Паліативної допомоги' },
                { code: 'reanimation', name: 'Реанімаційне' }
            ];

            // Все рационы
            const allRations = [
                { name: '1 Раціон (Гіпотрофія)', type: 'basic' },
                { name: '2 Раціон (Нормотрофія)', type: 'basic' },
                { name: '3 Раціон (Гіпертрофія)', type: 'basic' },
                { name: 'ЦД 2 типу', type: 'basic' },
                { name: 'Після операції', type: 'basic' },
                { name: 'Зонд', type: 'basic' },
                { name: 'Кішкові', type: 'basic' },
                { name: 'Індивідуальні', type: 'basic' },
                { name: 'Військ. 1', type: 'military' },
                { name: 'Військ. 2', type: 'military' },
                { name: 'Військ. 3', type: 'military' },
                { name: 'Військ. ЦД', type: 'military' },
                { name: 'Не харчуються', type: 'none' },
                { name: 'Без харчування (військ.)', type: 'military_none' }
            ];

            // Загружаем данные заказов
            const orders = JSON.parse(localStorage.getItem('departmentOrders') || '{}');

            // Генерация HTML для печати
            let printContent = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Замовлення харчування</title>';
            printContent += '<style>';
            printContent += '@page { size: A4 landscape; margin: 10mm; }';
            printContent += 'body { font-family: Arial, sans-serif; font-size: 8px; margin: 0; padding: 10px; }';
            printContent += 'h2 { text-align: center; font-size: 14px; margin: 10px 0; }';
            printContent += 'table { width: 100%; border-collapse: collapse; margin-top: 10px; }';
            printContent += 'th, td { border: 1px solid #000; padding: 4px 3px; text-align: center; }';
            printContent += 'th { background: #2c3e50; color: white; font-weight: 600; font-size: 7px; }';
            printContent += '.vertical-text { writing-mode: vertical-rl; text-orientation: mixed; height: 80px; padding: 3px 2px; }';
            printContent += '.dept-name { text-align: left; font-weight: 600; padding-left: 5px; }';
            printContent += '.total-row { background: #ecf0f1; font-weight: 700; }';
            printContent += '.highlight-col { background: #d5f4e6; font-weight: 700; }';
            printContent += '@media print { body { print-color-adjust: exact; -webkit-print-color-adjust: exact; } }';
            printContent += '</style></head><body>';

            const currentDate = new Date().toLocaleDateString('uk-UA');
            printContent += '<h2>ПОРЦІЙНИК (ОСНОВНИЙ)<br>на харчування хворих на ' + currentDate + '</h2>';
            printContent += '<table><thead><tr>';
            printContent += '<th style="min-width: 80px;">Найменування відділення</th>';
            printContent += '<th style="min-width: 35px;">Кільк. хворих</th>';

            allRations.forEach(ration => {
                printContent += '<th class="vertical-text">' + ration.name + '</th>';
            });

            printContent += '<th class="vertical-text" style="background: #27ae60;">Загальна кіл-ть на харч.</th>';
            printContent += '</tr></thead><tbody>';

            // Переменные для подсчета общих сумм
            let grandTotalPatients = 0;
            let grandTotals = new Array(14).fill(0);
            let grandTotalEating = 0;

            // Строки отделений
            departments.forEach(dept => {
                const deptData = orders[dept.code] || {};
                const totalPatients = deptData.total_patients || 0;

                const rationValues = [
                    deptData.ration_1 || 0,
                    deptData.ration_2 || 0,
                    deptData.ration_3 || 0,
                    deptData.diabetes || 0,
                    deptData.post_surgery || 0,
                    deptData.tube || 0,
                    deptData.intestinal || 0,
                    deptData.individual || 0,
                    deptData.military_1 || 0,
                    deptData.military_2 || 0,
                    deptData.military_3 || 0,
                    deptData.military_diabetes || 0,
                    deptData.not_eating || 0,
                    deptData.military_not_eating || 0
                ];

                const totalEating = deptData.total_eating || 0;

                // Обновляем общие суммы
                grandTotalPatients += totalPatients;
                rationValues.forEach((value, idx) => {
                    grandTotals[idx] += value;
                });
                grandTotalEating += totalEating;

                printContent += '<tr>';
                printContent += '<td class="dept-name">' + dept.name + '</td>';
                printContent += '<td>' + totalPatients + '</td>';

                rationValues.forEach(value => {
                    printContent += '<td>' + value + '</td>';
                });

                printContent += '<td class="highlight-col">' + totalEating + '</td>';
                printContent += '</tr>';
            });

            // Строка ВСЬОГО
            printContent += '<tr class="total-row">';
            printContent += '<td style="text-align: center;">ВСЬОГО:</td>';
            printContent += '<td>' + grandTotalPatients + '</td>';

            grandTotals.forEach(total => {
                printContent += '<td>' + total + '</td>';
            });

            printContent += '<td style="background: #27ae60; color: white;">' + grandTotalEating + '</td>';
            printContent += '</tr>';

            printContent += '</tbody></table>';
            printContent += '<' + '/body><' + '/html>';

            // Открываем окно печати
            const printWindow = window.open('', '_blank', 'width=800,height=600');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();

            setTimeout(function() {
                printWindow.print();
            }, 500);
        }

        // Функція для перегляду логів замовлень
        function viewOrdersLog() {
            const logs = JSON.parse(localStorage.getItem('ordersLogs') || '[]');

            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.id = 'viewLogsModal';

            let tableHTML = '';

            if (logs.length === 0) {
                tableHTML = '<p style="text-align: center; color: #7f8c8d; padding: 40px; font-size: 16px;">Немає записів у логах</p>';
            } else {
                tableHTML = `
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                            <thead>
                                <tr style="background: #2c3e50; color: white;">
                                    <th style="padding: 12px 10px; border: 1px solid #000; text-align: left; min-width: 100px;">Дата</th>
                                    <th style="padding: 12px 10px; border: 1px solid #000; text-align: left; min-width: 80px;">Час</th>
                                    <th style="padding: 12px 10px; border: 1px solid #000; text-align: left; min-width: 200px;">Адміністратор</th>
                                    <th style="padding: 12px 10px; border: 1px solid #000; text-align: left; min-width: 150px;">Дія</th>
                                    <th style="padding: 12px 10px; border: 1px solid #000; text-align: left; min-width: 150px;">Відділення</th>
                                    <th style="padding: 12px 10px; border: 1px solid #000; text-align: center; min-width: 80px;">Хворих</th>
                                    <th style="padding: 12px 10px; border: 1px solid #000; text-align: center; min-width: 100px;">На харчування</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                logs.forEach((log, index) => {
                    const bgColor = index % 2 === 0 ? '#ffffff' : '#f8f9fa';

                    // Визначаємо колір для різних типів дій
                    let actionColor = '#3498db'; // синій за замовчуванням
                    if (log.action.includes('Реєстрація')) {
                        actionColor = '#27ae60'; // зелений для реєстрації
                    } else if (log.action.includes('Редагування')) {
                        actionColor = '#f39c12'; // помаранчевий для редагування
                    } else if (log.action.includes('Деактивація')) {
                        actionColor = '#e74c3c'; // червоний для деактивації
                    }

                    // Відображення даних залежно від типу дії
                    let departmentCell = log.details.department || log.details.newAdminDepartment || '-';
                    let patientsCell = log.details.totalPatients !== undefined ? log.details.totalPatients : '-';
                    let eatingCell = log.details.totalEating !== undefined ? log.details.totalEating : '-';

                    tableHTML += `
                        <tr style="background: ${bgColor};">
                            <td style="padding: 10px; border: 1px solid #000;">${log.date}</td>
                            <td style="padding: 10px; border: 1px solid #000;">${log.time}</td>
                            <td style="padding: 10px; border: 1px solid #000;">
                                <strong>${log.adminFullName}</strong>
                                <br><small style="color: #7f8c8d;">${log.adminUsername}</small>
                            </td>
                            <td style="padding: 10px; border: 1px solid #000;">
                                <span style="background: ${actionColor}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 11px;">
                                    ${log.action}
                                </span>
                            </td>
                            <td style="padding: 10px; border: 1px solid #000;">${departmentCell}</td>
                            <td style="padding: 10px; border: 1px solid #000; text-align: center; font-weight: 600;">${patientsCell}</td>
                            <td style="padding: 10px; border: 1px solid #000; text-align: center; font-weight: 600; color: #27ae60;">${eatingCell}</td>
                        </tr>
                    `;
                });

                tableHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            }

            modalOverlay.innerHTML = `
                <div class="modal-window" style="max-width: 95%; width: 95%;">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Логи замовлень</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content" style="padding: 20px;">
                        <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <p style="color: #7f8c8d; margin: 0;">Всього записів: <strong>${logs.length}</strong></p>
                            <button class="action-btn btn-secondary" onclick="clearOrdersLog()" style="padding: 8px 16px;">
                                Очистити логи
                            </button>
                        </div>
                        ${tableHTML}
                    </div>
                </div>
            `;

            document.body.appendChild(modalOverlay);
            openModal(modalOverlay);
        }

        // Функція для перегляду архіву замовлень
        function viewOrdersArchive() {
            const ordersArchive = JSON.parse(localStorage.getItem('ordersArchive') || '{}');
            const dates = Object.keys(ordersArchive).sort().reverse(); // Сортуємо дати від новіших до старіших

            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.id = 'viewArchiveModal';

            let datesListHTML = '';

            if (dates.length === 0) {
                datesListHTML = '<p style="text-align: center; color: #7f8c8d; padding: 40px; font-size: 16px;">Архів порожній</p>';
            } else {
                datesListHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; padding: 10px;">
                `;

                dates.forEach(date => {
                    const dateObj = new Date(date);
                    const formattedDate = dateObj.toLocaleDateString('uk-UA', {
                        day: '2-digit',
                        month: 'long',
                        year: 'numeric'
                    });

                    const ordersCount = Object.keys(ordersArchive[date]).length;

                    datesListHTML += `
                        <div style="border: 2px solid #3498db; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s; background: white;"
                             onclick="viewOrdersByDate('${date}')"
                             onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 20px rgba(52,152,219,0.3)'; this.style.borderColor='#2980b9'"
                             onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='#3498db'">
                            <div style="font-size: 32px; margin-bottom: 10px;">📅</div>
                            <div style="font-weight: 600; color: #2c3e50; margin-bottom: 5px;">${formattedDate}</div>
                            <div style="font-size: 12px; color: #7f8c8d;">Замовлень: ${ordersCount}</div>
                        </div>
                    `;
                });

                datesListHTML += '</div>';
            }

            modalOverlay.innerHTML = `
                <div class="modal-window" style="max-width: 90%; width: 90%;">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Архів замовлень по датах</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content" style="padding: 20px;">
                        <div style="margin-bottom: 15px;">
                            <p style="color: #7f8c8d; margin: 0;">Виберіть дату для перегляду замовлень</p>
                        </div>
                        ${datesListHTML}
                    </div>
                </div>
            `;

            document.body.appendChild(modalOverlay);
            openModal(modalOverlay);
        }

        // Функція для перегляду замовлень за конкретну дату
        function viewOrdersByDate(date) {
            const ordersArchive = JSON.parse(localStorage.getItem('ordersArchive') || '{}');
            const ordersForDate = ordersArchive[date] || {};

            const departments = [
                { code: 'therapy', name: 'Терапевтичне' },
                { code: 'cardiology', name: 'Кардіологічне' },
                { code: 'neurology', name: 'Неврологічне' },
                { code: 'stroke', name: 'Інсультне' },
                { code: 'rehabilitation', name: 'Фіз. та реабілітац. мед' },
                { code: 'gynecology', name: 'Гінекологічне' },
                { code: 'surgery', name: 'Хірургічне' },
                { code: 'proctology', name: 'Проктологічне' },
                { code: 'oncology', name: 'Онкохіміотерапевтичне' },
                { code: 'palliative', name: 'Паліативної допомоги' },
                { code: 'reanimation', name: 'Реанімаційне' }
            ];

            const allRations = [
                { name: '1 Раціон (Гіпотрофія)', type: 'basic' },
                { name: '2 Раціон (Нормотрофія)', type: 'basic' },
                { name: '3 Раціон (Гіпертрофія)', type: 'basic' },
                { name: 'ЦД 2 типу', type: 'basic' },
                { name: 'Після операції', type: 'basic' },
                { name: 'Зонд', type: 'basic' },
                { name: 'Кішкові', type: 'basic' },
                { name: 'Індивідуальні', type: 'basic' },
                { name: 'Військ. 1', type: 'military' },
                { name: 'Військ. 2', type: 'military' },
                { name: 'Військ. 3', type: 'military' },
                { name: 'Військ. ЦД', type: 'military' },
                { name: 'Не харчуються', type: 'none' },
                { name: 'Без харчування (військ.)', type: 'military_none' }
            ];

            const dateObj = new Date(date);
            const formattedDate = dateObj.toLocaleDateString('uk-UA', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            // Генерация единой таблицы
            let tableHTML = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <thead>
                            <tr style="background: #2c3e50; color: white;">
                                <th style="padding: 8px 10px; text-align: left; border: 1px solid #000; font-weight: 600; min-width: 140px;">Найменування відділення</th>
                                <th style="padding: 8px 6px; text-align: center; border: 1px solid #000; font-weight: 600; min-width: 60px;">Кількість хворих</th>
                                ${allRations.map(ration => `<th style="padding: 8px 6px; text-align: center; border: 1px solid #000; font-weight: 600; min-width: 55px; writing-mode: vertical-rl; text-orientation: mixed; height: 120px;">${ration.name}</th>`).join('')}
                                <th style="padding: 8px 6px; text-align: center; border: 1px solid #000; font-weight: 600; background: #27ae60; min-width: 70px; writing-mode: vertical-rl; text-orientation: mixed; height: 120px;">Загальна кіл-ть на харч.</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            departments.forEach((dept, index) => {
                const bgColor = index % 2 === 0 ? '#ffffff' : '#f8f9fa';
                tableHTML += `
                    <tr style="background: ${bgColor};">
                        <td style="padding: 8px 10px; border: 1px solid #000; font-weight: 600; color: #2c3e50;">${dept.name}</td>
                `;

                // Получаем данные для этого отделения
                const deptData = ordersForDate[dept.code] || {};

                const totalPatients = deptData.total_patients || 0;
                tableHTML += `<td style="padding: 8px 6px; border: 1px solid #000; text-align: center; font-weight: 700;">${totalPatients}</td>`;

                // Все рационы
                const rationValues = [
                    deptData.ration_1 || 0,
                    deptData.ration_2 || 0,
                    deptData.ration_3 || 0,
                    deptData.diabetes || 0,
                    deptData.post_surgery || 0,
                    deptData.tube || 0,
                    deptData.intestinal || 0,
                    deptData.individual || 0,
                    deptData.military_1 || 0,
                    deptData.military_2 || 0,
                    deptData.military_3 || 0,
                    deptData.military_diabetes || 0,
                    deptData.not_eating || 0,
                    deptData.military_not_eating || 0
                ];

                rationValues.forEach(count => {
                    tableHTML += `
                        <td style="padding: 8px 6px; border: 1px solid #000; text-align: center;">${count}</td>
                    `;
                });

                const totalEating = deptData.total_eating || 0;
                tableHTML += `
                        <td style="padding: 8px 6px; border: 1px solid #000; text-align: center; font-weight: 700; background: #d5f4e6; color: #27ae60;">${totalEating}</td>
                    </tr>
                `;
            });

            // Строка ВСЬОГО
            tableHTML += `
                <tr style="background: #ecf0f1; font-weight: 700;">
                    <td style="padding: 8px 10px; border: 1px solid #000; text-align: center;">ВСЬОГО:</td>
            `;

            // Подсчитываем реальные суммы по всем отделениям
            let grandTotalPatients = 0;
            let grandTotals = new Array(14).fill(0);
            let grandTotalEating = 0;

            departments.forEach(dept => {
                const deptData = ordersForDate[dept.code] || {};
                grandTotalPatients += deptData.total_patients || 0;

                const rationValues = [
                    deptData.ration_1 || 0,
                    deptData.ration_2 || 0,
                    deptData.ration_3 || 0,
                    deptData.diabetes || 0,
                    deptData.post_surgery || 0,
                    deptData.tube || 0,
                    deptData.intestinal || 0,
                    deptData.individual || 0,
                    deptData.military_1 || 0,
                    deptData.military_2 || 0,
                    deptData.military_3 || 0,
                    deptData.military_diabetes || 0,
                    deptData.not_eating || 0,
                    deptData.military_not_eating || 0
                ];

                rationValues.forEach((value, idx) => {
                    grandTotals[idx] += value;
                });

                grandTotalEating += deptData.total_eating || 0;
            });

            tableHTML += `<td style="padding: 8px 6px; border: 1px solid #000; text-align: center;">${grandTotalPatients}</td>`;

            grandTotals.forEach(total => {
                tableHTML += `<td style="padding: 8px 6px; border: 1px solid #000; text-align: center;">${total}</td>`;
            });

            tableHTML += `
                    <td style="padding: 8px 6px; border: 1px solid #000; text-align: center; background: #27ae60; color: white;">${grandTotalEating}</td>
                </tr>
            `;

            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;

            // Закриваємо попереднє модальне вікно
            const archiveModal = document.getElementById('viewArchiveModal');
            if (archiveModal) {
                closeModal(archiveModal);
            }

            // Створюємо нове модальне вікно з таблицею
            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.id = 'viewDateOrdersModal';

            modalOverlay.innerHTML = `
                <div class="modal-window" style="max-width: 95%; width: 95%;">
                    <div class="modal-header" style="background: #2c3e50;">
                        <h2 class="modal-title" style="color: white;">Замовлення на ${formattedDate}</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove(); viewOrdersArchive();" style="color: white;">&times;</button>
                    </div>
                    <div class="modal-content" style="padding: 20px;">
                        <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <button class="action-btn btn-secondary" onclick="this.closest('.modal-overlay').remove(); viewOrdersArchive();">
                                ← Назад до архіву
                            </button>
                        </div>
                        ${tableHTML}
                    </div>
                </div>
            `;

            document.body.appendChild(modalOverlay);
            openModal(modalOverlay);
        }

        // Функція для очищення логів
        function clearOrdersLog() {
            if (confirm('Ви впевнені, що хочете очистити всі логи? Цю дію неможливо скасувати.')) {
                localStorage.removeItem('ordersLogs');

                // Закриваємо модальне вікно
                const modal = document.getElementById('viewLogsModal');
                if (modal) {
                    closeModal(modal);
                }

                // Показуємо повідомлення
                const notification = document.createElement('div');
                notification.className = 'notification success';
                notification.innerHTML = `
                    <div class="notification-content">
                        <span>Логи успішно очищено!</span>
                        <button class="notification-close" onclick="this.closest('.notification').remove()">&times;</button>
                    </div>
                `;
                document.body.appendChild(notification);

                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 3000);
            }
        }
    </script>
</body>
</html>